<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文件上传测试</title>
</head>
<body>
  <h1>文件上传测试</h1>

  <button id="uploadButton">上传图片</button>
  <input type="file" id="fileInput" style="display: none" accept="image/*">

  <div id="result"></div>

  <script>
    const uploadButton = document.getElementById('uploadButton');
    const fileInput = document.getElementById('fileInput');
    const result = document.getElementById('result');

    uploadButton.addEventListener('click', () => {
      console.log('Button clicked');
      fileInput.setAttribute('accept', 'image/*');
      fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
      console.log('File input changed');
      const file = e.target.files[0];
      if (file) {
        result.innerHTML = `
          <p>文件名: ${file.name}</p>
          <p>文件大小: ${file.size} bytes</p>
          <p>文件类型: ${file.type}</p>
        `;
      }
    });

    // 测试 setInputFiles 是否触发 change 事件
    window.testSetInputFiles = async () => {
      // 创建一个测试文件
      const testImagePng = new Uint8Array([
        0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A
      ]);

      const file = new File([testImagePng], 'test.png', { type: 'image/png' });

      // 创建 DataTransfer 对象
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);

      // 设置文件
      fileInput.files = dataTransfer.files;

      // 手动触发 change 事件
      const event = new Event('change', { bubbles: true });
      fileInput.dispatchEvent(event);
    };
  </script>
</body>
</html>
