# Prompt

`
发现中心里的我的PeerID要存储到LocalStorage里

而且不再设计一个中心化的发现中心了。每一个节点都承担发现中心的职责，我向其他节点询问他持有的朋友，我也响应其他人询问我我发现了哪些人。

在聊天中，可以直接新增一个聊天，主动输入对端设备的PeerId，然后聊天列表里直接出现这个对端设备，我就可以向这个设备发起聊天。第一时间，我就可以向这个设备发送消息。发送的消息要有发送状态，能展示是否送达。如何知道是否送达？那得对端收到消息之后向我反馈送达，这样本设备端才可以展示送达。同样的别人发消息给我，我也要反馈一个送达给对方，方便对端展示已送达。

未送达的消息，如果发送失败，会无限次的自动重试发送。除非用户删除这个聊天。

发送的消息类型支持文本、图片、文件、视频。

发送工具是  vue-peerjs-util/src/util/PeerHttpUtil.ts ，这是一个类Http的工具，每次要发送消息时，才和对方建立一个conn，且不会复用这个 conn。对端接收到消息后，由对端来关闭conn。

每条消息最好有一个唯一标识，如果对端的送达消息不及时，我这端重试发送，可以通过唯一标识确认已经送达过了。

发送消息采用三段式通信，我先发送消息唯一标识给对端，让对端去检查消息唯一标识是否存在，如果不存在，则由对端向我发起请求，请求这个消息ID的内容，这是二段，我在返回消息内容给对端，这是第三段。这样做的好处，就是我在不断重试的时候，仅仅发送消息ID，消息体积不大，对端实际要数据时候，他拉拉取我，我再给实际的消息内容，这个消息内容可能很大，但是由对方向我请求，就不会频繁发送占用大量网络。

目前我对需求就想到这么多，你整理一下，然后实现我的需求。
`