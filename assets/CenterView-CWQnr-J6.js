import{c as n,I as F,d as Le,o as Re,x as Be,a as pe,k as h,g as y,i as d,h as f,w as a,r as I,e as g,f as p,t as _,b as P,j as b,P as Ne,n as ve,F as ee,m as me,R as qe,q as x,u as He,y as Ve,C as Fe}from"./index-C7JC_cEt.js";import{u as Qe,a as We}from"./PeerHttpUtil-CqeeV06i.js";import{a as Ge,u as Je}from"./index-Dm-OtRYb.js";import{R as Xe}from"./RadarChartOutlined-oP37OlBa.js";import{U as Ye,S as Ze}from"./UserOutlined-CjmzrY-n.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logger-CUkP4sI-.js";import"./networkLogDB-bSBVLm5N.js";import"./cryptoManager-BXa9bEtX.js";var tt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M899.6 276.5L705 396.4 518.4 147.5a8.06 8.06 0 00-12.9 0L319 396.4 124.3 276.5c-5.7-3.5-13.1 1.2-12.2 7.9L188.5 865c1.1 7.9 7.9 14 16 14h615.1c8 0 14.9-6 15.9-14l76.4-580.6c.8-6.7-6.5-11.4-12.3-7.9zm-126 534.1H250.3l-53.8-409.4 139.8 86.1L512 252.9l175.7 234.4 139.8-86.1-53.9 409.4zM512 509c-62.1 0-112.6 50.5-112.6 112.6S449.9 734.2 512 734.2s112.6-50.5 112.6-112.6S574.1 509 512 509zm0 160.9c-26.6 0-48.2-21.6-48.2-48.3 0-26.6 21.6-48.3 48.2-48.3s48.2 21.6 48.2 48.3c0 26.6-21.6 48.3-48.2 48.3z"}}]},name:"crown",theme:"outlined"};function ye(i){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(o).filter(function(m){return Object.getOwnPropertyDescriptor(o,m).enumerable}))),c.forEach(function(m){nt(i,m,o[m])})}return i}function nt(i,e,o){return e in i?Object.defineProperty(i,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[e]=o,i}var q=function(e,o){var c=ye({},e,o.attrs);return n(F,ye({},c,{icon:tt}),null)};q.displayName="CrownOutlined";q.inheritAttrs=!1;var rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"};function ge(i){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(o).filter(function(m){return Object.getOwnPropertyDescriptor(o,m).enumerable}))),c.forEach(function(m){at(i,m,o[m])})}return i}function at(i,e,o){return e in i?Object.defineProperty(i,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[e]=o,i}var H=function(e,o){var c=ge({},e,o.attrs);return n(F,ge({},c,{icon:rt}),null)};H.displayName="KeyOutlined";H.inheritAttrs=!1;var ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function _e(i){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(o).filter(function(m){return Object.getOwnPropertyDescriptor(o,m).enumerable}))),c.forEach(function(m){st(i,m,o[m])})}return i}function st(i,e,o){return e in i?Object.defineProperty(i,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[e]=o,i}var te=function(e,o){var c=_e({},e,o.attrs);return n(F,_e({},c,{icon:ot}),null)};te.displayName="SyncOutlined";te.inheritAttrs=!1;var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824.2 699.9a301.55 301.55 0 00-86.4-60.4C783.1 602.8 812 546.8 812 484c0-110.8-92.4-201.7-203.2-200-109.1 1.7-197 90.6-197 200 0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 00-86.4 60.4C345 754.6 314 826.8 312 903.8a8 8 0 008 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5A226.62 226.62 0 01612 684c60.9 0 118.2 23.7 161.3 66.8C814.5 792 838 846.3 840 904.3c.1 4.3 3.7 7.7 8 7.7h56a8 8 0 008-8.2c-2-77-33-149.2-87.8-203.9zM612 612c-34.2 0-66.4-13.3-90.5-37.5a126.86 126.86 0 01-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4 0 34.2-13.3 66.3-37.5 90.5A127.3 127.3 0 01612 612zM361.5 510.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 01-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.9-1.7-203.3 89.2-203.3 199.9 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 008 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.9-1 6.5-4.7 6-8.7z"}}]},name:"team",theme:"outlined"};function he(i){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(o).filter(function(m){return Object.getOwnPropertyDescriptor(o,m).enumerable}))),c.forEach(function(m){it(i,m,o[m])})}return i}function it(i,e,o){return e in i?Object.defineProperty(i,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[e]=o,i}var V=function(e,o){var c=he({},e,o.attrs);return n(F,he({},c,{icon:lt}),null)};V.displayName="TeamOutlined";V.inheritAttrs=!1;const ct={class:"center-container"},ut={class:"page-header"},dt={class:"page-title"},ft={class:"info-section"},pt={class:"avatar-section"},vt={class:"username-text"},mt={key:0,class:"bootstrap-badge"},yt={class:"security-section"},gt={class:"key-display"},_t={class:"query-section"},ht={key:0,class:"empty-state"},bt={key:1,class:"devices-grid"},wt=["onClick"],Ct={class:"device-header"},It={class:"device-info"},Ot={class:"device-name"},Dt={class:"device-peer-id"},Pt={class:"device-status"},kt={class:"device-tags"},xt={key:1,class:"refresh-duration"},St={key:0,class:"device-actions"},zt={key:0,class:"devices-keys-section"},$t={class:"device-key-header"},Ut={class:"device-key-name"},Mt={key:0,class:"warning-section"},Et={class:"public-key-modal-content"},Tt={key:0,class:"warning-section"},Kt=Le({__name:"CenterView",setup(i){He();const e=Qe(),o=Ge(),c=We(),m=Je(),{isConnected:K,isBootstrap:be,addDiscoveredDevice:ne,sendDiscoveryNotification:re,queryUsername:we,checkOnline:ae,requestAllDeviceLists:Ce,requestDeviceList:Ie,tryBecomeBootstrap:Oe}=m,U=I(""),De=I(!1),j=I(!1),A=I(""),oe=I("info"),L=I(new Map),R=I(!1),Q=I(""),W=I(""),M=I(void 0);function G(t){return L.value.get(t)||{refreshing:!1,duration:null,error:!1}}const E=x(()=>c.allDevices),se=x(()=>e.myPublicKey),Pe=x(()=>e.myPrivateKey),ke=x(()=>e.isCryptoInitialized),le=x(()=>B.value.filter(t=>t.peerId!==e.myPeerId&&t.peerId!=="connecting..."&&t.publicKey));function J(t){return t.length<40?t:`${t.substring(0,20)}...${t.substring(t.length-20)}`}const xe=x(()=>se.value?J(se.value):"加载中...");function X(t){switch(t){case"verified":return"success";case"exchanged":return"processing";case"compromised":return"error";case"pending":return"warning";default:return"default"}}function Y(t){switch(t){case"verified":return"已验证";case"exchanged":return"已交换";case"compromised":return"被攻击";case"pending":return"交换中";default:return"未交换"}}async function Se(t){const r=c.getDevice(t);r?.publicKey&&(await navigator.clipboard.writeText(r.publicKey),console.log("[CenterView] Device public key copied:",t))}const T=x(()=>e.userInfo.username?{peerId:e.myPeerId||"connecting...",username:e.userInfo.username||e.myPeerId||"Unknown",avatar:e.userInfo.avatar||null,lastHeartbeat:Date.now(),firstDiscovered:Date.now(),isOnline:!0}:null),B=x(()=>{const t=[...E.value];if(T.value){const r=T.value.peerId,l=t.findIndex(u=>u.peerId===r);l>=0?t[l]={...t[l],username:T.value.username,avatar:T.value.avatar,lastHeartbeat:Date.now()}:t.push(T.value)}return t.sort((r,l)=>l.lastHeartbeat-r.lastHeartbeat)});function ze(t){return o.getContact(t)!==void 0}Re(async()=>{await e.loadUserInfo(),console.log("[Center] User info loaded:",{username:e.userInfo.username,avatarLength:e.userInfo.avatar?.length||0,myPeerId:e.myPeerId}),window.__pendingDiscoveryUpdate&&(console.log("[Center] Found pending discovery update, processing now"),setTimeout(()=>{D(),delete window.__pendingDiscoveryUpdate},100)),console.log("[Center] User info loaded:",{username:e.userInfo.username,avatarLength:e.userInfo.avatar?.length||0,myPeerId:e.myPeerId});const r=performance.now();console.log("[Center-Performance] ===== 组件开始挂载 ====="),console.log("[Center-Performance] Timestamp:",Date.now());const l=(C,z)=>{const $=performance.now(),N=Math.round($-r);console.log(`[Center-Performance] [${C}] +${N}ms ${z}`),window.__performanceLogs||(window.__performanceLogs=[]),window.__performanceLogs.push({timestamp:Date.now(),phase:C,duration:N,message:z})};l("start","组件开始挂载"),l("before-bootstrap","准备成为宇宙启动者");const u=performance.now();Oe(),l("after-bootstrap",`成为宇宙启动者调用完成 (耗时 ${Math.round(performance.now()-u)}ms)`),l("before-load-devices","准备加载设备列表");const v=performance.now();await c.loadDevices(),l("after-load-devices",`设备列表加载完成 (耗时 ${Math.round(performance.now()-v)}ms)`),l("before-load-chat","准备加载聊天数据");const w=performance.now();o.loadFromStorage(),l("after-load-chat",`聊天数据加载完成 (耗时 ${Math.round(performance.now()-w)}ms)`),l("before-heartbeat","准备启动心跳定时器");const k=e.loadDeviceCheckInterval(),O=e.loadDeviceCheckTimeout()*1e3;c.startHeartbeatTimer(async C=>{if(!K.value)return!1;try{return await ae(C.peerId,O)}catch(z){return console.error("[Center] Heartbeat check error:",z),!1}},k),l("after-heartbeat","心跳定时器启动完成");const D=()=>{console.log("[Center] Discovery devices updated, refreshing..."),c.updateOnlineStatus(),c.allDevices.forEach(C=>{o.getContact(C.peerId)&&o.setContactOnline(C.peerId,C.isOnline??!1)}),Be(()=>{console.log("[Center] Discovery update processed, UI refreshed")})};window.__pendingDiscoveryUpdate&&(console.log("[Center] Processing pending discovery update"),D(),delete window.__pendingDiscoveryUpdate),window.addEventListener("discovery-devices-updated",D),l("event-listeners","事件监听器注册完成"),pe(()=>{window.removeEventListener("discovery-devices-updated",D)}),l("complete","组件挂载完成");const Z=Math.round(performance.now()-r);console.log("[Center-Performance] ===== 组件挂载完成 ====="),console.log("[Center-Performance] 总耗时:",Z,"ms")}),pe(()=>{});function S(t,r="info"){A.value=t,oe.value=r}function ie(){A.value=""}async function ce(){if(ie(),!U.value.trim()){S("请输入要添加的 Peer ID","warning");return}const t=U.value.trim();if(E.value.find(u=>u.peerId===t)){S("该设备已存在","info"),console.log("[Center] Device already exists, but sending discovery notification anyway:",t);try{await re(t),console.log("[Center] Discovery notification sent to existing device:",t)}catch(u){console.error("[Center] Error sending discovery notification:",u)}U.value="";return}console.log("[Center] Adding device manually:",t);const l={peerId:t,username:t,avatar:null,lastHeartbeat:Date.now(),firstDiscovered:Date.now(),isOnline:!0};ne(l),console.log("[Center] Device added to store:",l),console.log("[Center] Sending discovery notification to:",t);try{await re(t),console.log("[Center] Discovery notification sent to:",t)}catch(u){console.error("[Center] Error sending discovery notification:",u)}S(`已添加设备 ${t}`,"success"),U.value="",Ie(t).then(u=>{u.length>0&&console.log("[Center] Discovered "+u.length+" devices from "+t)}).catch(u=>{console.error("[Center] Request device list error:",u)}),console.log("[Center] About to query username for:",t),we(t).then(u=>{u?(console.log("[Center] Received user info:",u),l.username=u.username,l.avatar=u.avatar,ne({...l}),c.addOrUpdateDevice({...l})):(console.warn("[Center] Failed to get user info for:",t),c.addOrUpdateDevice({...l}))}).catch(u=>{console.error("[Center] Error querying username:",u)})}function $e(t){o.createChat(t.peerId,t.username),S(`已添加 ${t.username} 到聊天列表`,"success")}function Ue(t){if(!t.publicKey){S("该设备暂无公钥信息","warning");return}Q.value=t.publicKey,W.value=t.username,M.value=t.keyExchangeStatus,R.value=!0}function Me(){R.value=!1,Q.value="",W.value="",M.value=void 0}async function Ee(){ie(),console.log("[Center] Refresh discovery started"),j.value=!0;try{K.value||console.warn("[Center] Not connected to Peer Server"),e.myPeerId||console.warn("[Center] User info not set");const t=E.value.filter(l=>l.peerId!==e.myPeerId);t.forEach(l=>{L.value.set(l.peerId,{refreshing:!0,duration:null,error:!1})});try{await Ce()}catch(l){console.error("[Center] Request device lists error:",l)}j.value=!1;const r=t.map(async l=>{const u=Date.now(),v=l.peerId;try{const w=await ae(v),k=Date.now()-u;return c.updateDeviceOnlineStatus(v,w),o.getContact(v)&&o.setContactOnline(v,w),L.value.set(v,{refreshing:!1,duration:k,error:!1}),console.log("[Center] Device "+v+" checked: online="+w+", duration="+k+"ms"),{peerId:v,isOnline:w,duration:k}}catch(w){return console.warn("[Center] Check online failed for "+v+":",w),L.value.set(v,{refreshing:!1,duration:null,error:!0}),{peerId:v,isOnline:!1,duration:null}}});Promise.allSettled(r).then(l=>{const u=l.filter(v=>v.status==="fulfilled"&&v.value.isOnline).length;console.log("[Center] Refresh completed: "+E.value.length+" devices, "+u+" online"),S(`已刷新，当前发现 ${E.value.length} 个设备，其中 ${u} 个在线`,"success")})}catch(t){console.error("[Center] Refresh error:",t),S("刷新失败","error"),j.value=!1}}return(t,r)=>{const l=g("a-avatar"),u=g("a-descriptions-item"),v=g("a-typography-text"),w=g("a-badge"),k=g("a-descriptions"),O=g("a-tag"),D=g("a-card"),Z=g("a-collapse-panel"),C=g("a-collapse"),z=g("a-col"),$=g("a-button"),N=g("a-input"),ue=g("a-space"),Te=g("a-typography-paragraph"),Ke=g("a-empty"),de=g("a-alert"),je=g("a-row"),Ae=g("a-modal");return p(),h("div",ct,[y("div",ut,[y("h1",dt,[n(d(Xe),{class:"title-icon"}),r[2]||(r[2]=f(" 发现中心 ",-1))]),r[3]||(r[3]=y("p",{class:"page-subtitle"},"去中心化的设备发现与互联",-1))]),n(je,{gutter:[20,20]},{default:a(()=>[n(z,{xs:24,lg:6},{default:a(()=>[n(D,{class:"my-info-card",bordered:!1},{title:a(()=>[n(d(Ye)),r[4]||(r[4]=f(" 我的信息 ",-1))]),default:a(()=>[y("div",ft,[y("div",pt,[n(l,{size:80,src:d(e).userInfo.avatar},{default:a(()=>[f(_(d(e).userInfo.username?.charAt(0).toUpperCase()||"U"),1)]),_:1},8,["src"])]),n(k,{column:1,size:"small"},{default:a(()=>[n(u,{label:"用户名"},{default:a(()=>[y("span",vt,_(d(e).userInfo.username||"未设置"),1)]),_:1}),n(u,{label:"Peer ID"},{default:a(()=>[d(e).myPeerId?(p(),P(v,{key:0,copyable:"","copy-text":d(e).myPeerId,class:"peer-id-text"},{default:a(()=>[f(_(d(e).myPeerId),1)]),_:1},8,["copy-text"])):(p(),P(v,{key:1,type:"secondary"},{default:a(()=>[...r[5]||(r[5]=[f("连接中...",-1)])]),_:1}))]),_:1}),n(u,{label:"连接状态"},{default:a(()=>[n(w,{status:d(K)?"processing":"error",text:d(K)?"已连接":"未连接"},null,8,["status","text"])]),_:1})]),_:1}),d(be)?(p(),h("div",mt,[n(O,{color:"purple",style:{margin:"0"}},{default:a(()=>[n(d(q),{style:{"margin-right":"4px"}}),r[6]||(r[6]=f(" 宇宙启动者 ",-1))]),_:1})])):b("",!0)])]),_:1}),ke.value?(p(),P(D,{key:0,class:"security-card",title:"身份安全",bordered:!1},{title:a(()=>[n(d(Ze)),r[7]||(r[7]=f(" 身份安全 ",-1))]),default:a(()=>[y("div",yt,[y("div",gt,[r[8]||(r[8]=y("div",{class:"key-label"},"我的公钥",-1)),n(v,{code:"",copyable:"",class:"key-text"},{default:a(()=>[f(_(xe.value),1)]),_:1})]),n(C,{ghost:"",class:"private-key-collapse"},{default:a(()=>[n(Z,{header:"查看私钥"},{default:a(()=>[n(v,{code:"",class:"key-text"},{default:a(()=>[f(_(Pe.value||"未初始化"),1)]),_:1})]),_:1})]),_:1})])]),_:1})):b("",!0)]),_:1}),n(z,{xs:24,lg:18},{default:a(()=>[n(D,{class:"discovery-card",bordered:!1},{title:a(()=>[n(d(V)),r[9]||(r[9]=f(" 在线设备 ",-1)),n(w,{count:B.value.length,"number-style":{backgroundColor:"#52c41a"},style:{"margin-left":"8px"}},null,8,["count"])]),extra:a(()=>[n($,{loading:j.value,onClick:Ee,"aria-label":"refresh-discovery"},{icon:a(()=>[n(d(qe))]),default:a(()=>[r[10]||(r[10]=f(" 刷新 ",-1))]),_:1},8,["loading"])]),default:a(()=>[y("div",_t,[n(ue,{compact:"",style:{width:"100%"}},{default:a(()=>[n(N,{value:U.value,"onUpdate:value":r[0]||(r[0]=s=>U.value=s),placeholder:"输入 Peer ID 添加设备",onPressEnter:ce,style:{flex:"1"}},null,8,["value"]),n($,{type:"primary",onClick:ce,loading:De.value,"aria-label":"add-device-button"},{icon:a(()=>[n(d(Ne))]),default:a(()=>[r[11]||(r[11]=f(" 添加 ",-1))]),_:1},8,["loading"])]),_:1}),A.value?(p(),h("div",{key:0,class:ve(["inline-message",`inline-message-${oe.value}`])},_(A.value),3)):b("",!0)]),B.value.length===0?(p(),h("div",ht,[n(Ke,{description:"暂无设备"},{image:a(()=>[n(d(V),{style:{"font-size":"64px",color:"#d9d9d9"}})]),default:a(()=>[n(Te,{type:"secondary"},{default:a(()=>[...r[12]||(r[12]=[f(" 输入其他设备的 Peer ID 添加设备，开始去中心化通信 ",-1)])]),_:1})]),_:1})])):(p(),h("div",bt,[(p(!0),h(ee,null,me(B.value,s=>(p(),h("div",{key:s.peerId,class:ve(["device-item",{"is-me":s.peerId===d(e).myPeerId||s.peerId==="connecting...","is-offline":!s.isOnline}]),onClick:fe=>s.peerId!==d(e).myPeerId&&s.peerId!=="connecting..."&&$e(s)},[y("div",Ct,[n(l,{src:s.avatar||void 0,size:48},{default:a(()=>[f(_(s.username.charAt(0).toUpperCase()),1)]),_:2},1032,["src"]),y("div",It,[y("div",Ot,_(s.username),1),y("div",Dt,_(s.peerId),1)]),y("div",Pt,[n(w,{status:s.isOnline?"processing":"default",text:s.isOnline?"在线":"离线"},null,8,["status","text"])])]),y("div",kt,[s.peerId===d(e).myPeerId?(p(),P(O,{key:0,color:"blue",size:"small"},{default:a(()=>[...r[13]||(r[13]=[f("我",-1)])]),_:1})):b("",!0),s.isBootstrap?(p(),P(O,{key:1,color:"purple",size:"small"},{default:a(()=>[n(d(q),{style:{"margin-right":"2px"}}),r[14]||(r[14]=f(" 启动者 ",-1))]),_:1})):b("",!0),ze(s.peerId)?(p(),P(O,{key:2,color:"green",size:"small"},{default:a(()=>[...r[15]||(r[15]=[f("聊天中",-1)])]),_:1})):b("",!0),s.keyExchangeStatus&&s.keyExchangeStatus!=="exchanged"?(p(),P(O,{key:3,color:X(s.keyExchangeStatus),size:"small"},{default:a(()=>[f(_(Y(s.keyExchangeStatus)),1)]),_:2},1032,["color"])):b("",!0),s.isOnline&&s.peerId!==d(e).myPeerId?(p(),h(ee,{key:4},[G(s.peerId).refreshing?(p(),P(d(te),{key:0,spin:"",class:"refresh-icon"})):G(s.peerId).duration!==null?(p(),h("span",xt,_(G(s.peerId).duration)+"ms ",1)):b("",!0)],64)):b("",!0)]),s.peerId!==d(e).myPeerId&&s.peerId!=="connecting..."?(p(),h("div",St,[s.publicKey?(p(),P($,{key:0,type:"text",size:"small",onClick:Ve(fe=>Ue(s),["stop"]),"aria-label":"view-public-key"},{default:a(()=>[n(d(H)),r[16]||(r[16]=f(" 公钥 ",-1))]),_:1},8,["onClick"])):b("",!0)])):b("",!0)],10,wt))),128))]))]),_:1}),le.value.length>0?(p(),h("div",zt,[n(D,{title:"设备公钥",bordered:!1},{title:a(()=>[n(d(H)),r[17]||(r[17]=f(" 设备公钥 ",-1))]),default:a(()=>[n(ue,{direction:"vertical",size:12,style:{width:"100%"}},{default:a(()=>[(p(!0),h(ee,null,me(le.value,s=>(p(),h("div",{key:s.peerId,class:"device-key-item"},[y("div",$t,[n(l,{src:s.avatar||void 0,size:32},{default:a(()=>[f(_(s.username.charAt(0).toUpperCase()),1)]),_:2},1032,["src"]),y("span",Ut,_(s.username),1),n(O,{color:X(s.keyExchangeStatus),size:"small"},{default:a(()=>[f(_(Y(s.keyExchangeStatus)),1)]),_:2},1032,["color"]),n($,{type:"text",size:"small",onClick:fe=>Se(s.peerId),"aria-label":"copy-device-public-key"},{default:a(()=>[n(d(Fe))]),_:1},8,["onClick"])]),n(v,{code:"",class:"device-key-text"},{default:a(()=>[f(_(J(s.publicKey||"")),1)]),_:2},1024),s.keyExchangeStatus==="compromised"?(p(),h("div",Mt,[n(de,{type:"warning",message:"安全警告",description:"此设备的公钥已发生变化","show-icon":"",size:"small"})])):b("",!0)]))),128))]),_:1})]),_:1})])):b("",!0)]),_:1})]),_:1}),n(Ae,{open:R.value,"onUpdate:open":r[1]||(r[1]=s=>R.value=s),title:`${W.value} 的公钥`,width:"500px","aria-label":"device-public-key-modal"},{footer:a(()=>[n($,{onClick:Me},{default:a(()=>[...r[18]||(r[18]=[f("关闭",-1)])]),_:1})]),default:a(()=>[y("div",Et,[n(k,{column:1,size:"small"},{default:a(()=>[n(u,{label:"密钥交换状态"},{default:a(()=>[n(O,{color:X(M.value)},{default:a(()=>[f(_(Y(M.value)),1)]),_:1},8,["color"])]),_:1}),n(u,{label:"公钥"},{default:a(()=>[n(v,{code:"",copyable:"",class:"modal-key-text"},{default:a(()=>[f(_(J(Q.value)),1)]),_:1})]),_:1})]),_:1}),M.value==="compromised"?(p(),h("div",Tt,[n(de,{type:"warning",message:"安全警告",description:"此设备的公钥已发生变化，可能存在中间人攻击","show-icon":""})])):b("",!0)])]),_:1},8,["open","title"])])}}}),Ft=et(Kt,[["__scopeId","data-v-d6f11c84"]]);export{Ft as default};
