class i{static instance;db=null;DB_NAME="P2PNetworkLogDB";DB_VERSION=1;STORE_NAME="network_logs";constructor(){}static getInstance(){return i.instance||(i.instance=new i),i.instance}async init(){return new Promise((e,t)=>{const n=indexedDB.open(this.DB_NAME,this.DB_VERSION);n.onerror=()=>{t(new Error("Failed to open IndexedDB"))},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=r=>{const s=r.target.result;if(!s.objectStoreNames.contains(this.STORE_NAME)){const o=s.createObjectStore(this.STORE_NAME,{keyPath:"id",autoIncrement:!0});o.createIndex("timestamp","timestamp",{unique:!1}),o.createIndex("direction","direction",{unique:!1}),o.createIndex("peerId","peerId",{unique:!1}),o.createIndex("protocol","protocol",{unique:!1})}}})}async addLog(e){return this.db||await this.init(),new Promise((t,n)=>{const o=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).add(e);o.onsuccess=()=>{t(o.result)},o.onerror=()=>{n(new Error("Failed to add log"))}})}async getLogs(e=1,t=20){return this.db||await this.init(),new Promise((n,r)=>{const o=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME),w=o.index("timestamp"),a=[],u=o.count();u.onsuccess=()=>{const d=u.result,l=w.openCursor(null,"prev");let E=(e-1)*t,h=0;l.onsuccess=b=>{const c=b.target.result;if(c){if(E>0){E--,c.continue();return}h<t?(a.push(c.value),h++,c.continue()):n({data:a,total:d,page:e,pageSize:t})}else n({data:a,total:d,page:e,pageSize:t})},l.onerror=()=>{r(new Error("Failed to query logs"))}},u.onerror=()=>{r(new Error("Failed to count logs"))}})}async clearAllLogs(){return this.db||await this.init(),new Promise((e,t)=>{const s=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).clear();s.onsuccess=()=>{e()},s.onerror=()=>{t(new Error("Failed to clear logs"))}})}async getTotalCount(){return this.db||await this.init(),new Promise((e,t)=>{const s=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).count();s.onsuccess=()=>{e(s.result)},s.onerror=()=>{t(new Error("Failed to count logs"))}})}}const S=i.getInstance();export{S as n};
