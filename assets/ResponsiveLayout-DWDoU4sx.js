import{c as r,I as G,d as Ee,o as Oe,a as we,r as p,b as g,w as l,u as Me,e as i,f as v,g as d,h as y,t as m,i as _,P as Se,j as B,k,n as te,l as Pe,m as D,p as N,F as Le,q as V,s as H,v as Re}from"./index-BJRbWrZn.js";import{u as ke,a as Ie}from"./index-Iins0OtH.js";import{M as Te,f as ze}from"./fileHelper-QisBlk73.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PeerHttpUtil-CtNkY1zz.js";import"./networkLogDB-BlD6FS5Z.js";var Ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"};function ae(s){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},t=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(a).filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable}))),t.forEach(function(c){Ae(s,c,a[c])})}return s}function Ae(s,e,a){return e in s?Object.defineProperty(s,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[e]=a,s}var F=function(e,a){var t=ae({},e,a.attrs);return r(G,ae({},t,{icon:Ue}),null)};F.displayName="MenuOutlined";F.inheritAttrs=!1;var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M926.8 397.1l-396-288a31.81 31.81 0 00-37.6 0l-396 288a31.99 31.99 0 00-11.6 35.8l151.3 466a32 32 0 0030.4 22.1h489.5c13.9 0 26.1-8.9 30.4-22.1l151.3-466c4.2-13.2-.5-27.6-11.7-35.8zM838.6 417l-98.5 32-200-144.7V199.9L838.6 417zM466 567.2l-89.1 122.3-55.2-169.2L466 567.2zm-116.3-96.8L484 373.3v140.8l-134.3-43.7zM512 599.2l93.9 128.9H418.1L512 599.2zm28.1-225.9l134.2 97.1L540.1 514V373.3zM558 567.2l144.3-46.9-55.2 169.2L558 567.2zm-74-367.3v104.4L283.9 449l-98.5-32L484 199.9zM169.3 470.8l86.5 28.1 80.4 246.4-53.8 73.9-113.1-348.4zM327.1 853l50.3-69h269.3l50.3 69H327.1zm414.5-33.8l-53.8-73.9 80.4-246.4 86.5-28.1-113.1 348.4z"}}]},name:"radar-chart",theme:"outlined"};function ne(s){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},t=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(a).filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable}))),t.forEach(function(c){je(s,c,a[c])})}return s}function je(s,e,a){return e in s?Object.defineProperty(s,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[e]=a,s}var W=function(e,a){var t=ne({},e,a.attrs);return r(G,ne({},t,{icon:xe}),null)};W.displayName="RadarChartOutlined";W.inheritAttrs=!1;var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"};function oe(s){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},t=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(a).filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable}))),t.forEach(function(c){Be(s,c,a[c])})}return s}function Be(s,e,a){return e in s?Object.defineProperty(s,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[e]=a,s}var q=function(e,a){var t=oe({},e,a.attrs);return r(G,oe({},t,{icon:$e}),null)};q.displayName="SettingOutlined";q.inheritAttrs=!1;const De={class:"avatar-upload-container"},Ne={class:"user-card"},Ve={class:"user-info"},He={class:"username"},Ge={class:"peer-id"},Fe={key:1,class:"mobile-wrapper"},We={class:"header-title"},qe={class:"user-card"},Je={class:"user-info"},Ke={class:"username"},Qe={class:"peer-id"},Xe={class:"footer-label"},Ye=Ee({__name:"ResponsiveLayout",setup(s){const e=Me(),a=Re(),t=ke(),{init:c}=Ie(),A=p(!1),I=p(!1);function x(){A.value=window.innerWidth<768}Oe(async()=>{console.log("[ResponsiveLayout] onMounted: pathname =",window.location.pathname,", hash =",window.location.hash),console.log("[ResponsiveLayout] localStorage E2E_TEST_MODE =",localStorage.getItem("__E2E_TEST_MODE__")),console.log("[ResponsiveLayout] localStorage E2E_TARGET_ROUTE =",localStorage.getItem("__E2E_TARGET_ROUTE__")),x(),window.addEventListener("resize",x);const o=localStorage.getItem("__E2E_TEST_MODE__"),n=localStorage.getItem("__E2E_TARGET_ROUTE__");if(o==="true"&&n){console.log("[ResponsiveLayout] E2E 测试模式：检测到标记，目标路由 =",n),localStorage.removeItem("__E2E_TEST_MODE__"),localStorage.removeItem("__E2E_TARGET_ROUTE__");const f=await t.loadUserInfo();if(console.log("[ResponsiveLayout] E2E 测试模式：用户信息加载结果 isSetup =",f),!f){console.log("[ResponsiveLayout] E2E 测试模式：用户信息未设置，显示设置弹窗"),O.value=!0;return}const M=n.charAt(0).toUpperCase()+n.slice(1);console.log("[ResponsiveLayout] E2E 测试模式：导航到",M),await e.replace({name:M}),await new Promise(S=>{const R=e.afterEach(($,X)=>{console.log("[ResponsiveLayout] E2E 测试模式：路由导航完成",$.name),R(),S()});e.currentRoute.value.name===M&&(console.log("[ResponsiveLayout] E2E 测试模式：路由已经是",M),S())});try{await c(),console.log("[ResponsiveLayout] E2E 测试模式：Peer 初始化完成，myPeerId =",t.myPeerId)}catch(S){console.error("[ResponsiveLayout] E2E 测试模式：Peer init failed:",S)}console.log("[ResponsiveLayout] E2E 测试模式：导航完成");return}if(!await t.loadUserInfo())O.value=!0;else try{await c()}catch(f){console.error("Peer init failed:",f)}}),we(()=>{window.removeEventListener("resize",x)});const T=[{key:"WeChat",label:"聊天",icon:Te,route:"/wechat"},{key:"Center",label:"发现中心",icon:W,route:"/center"},{key:"Settings",label:"设置",icon:q,route:"/settings"},{key:"NetworkLog",label:"网络日志",icon:Le,route:"/network-log"}],le=T.slice(0,4);function j(o){e.push(o),I.value=!1}const z=H(()=>a.name),se=H(()=>T.find(n=>n.key===z.value)?.label||"P2P Chat");function J(o){return o?o.length<16?o:`${o.substring(0,8)}...${o.substring(o.length-8)}`:"未知"}const O=p(!1),b=p(""),h=p(!1),E=p(""),w=p([]),C=p(""),K=p("info"),re=H(()=>E.value||t.userInfo.avatar||"");function P(o,n="info"){C.value=o,K.value=n}function ue(){C.value=""}async function Q(){const o=b.value.trim();if(ue(),!o){P("用户名不能为空，请输入用户名","warning");return}if(o.length<2){P("用户名至少需要2个字符","warning");return}if(o.length>20){P("用户名不能超过20个字符","warning");return}h.value=!0;try{await c(),t.saveUserInfo({username:o,avatar:E.value||null}),O.value=!1,b.value="",E.value="",w.value=[],P("设置完成","success")}catch(n){console.error("User setup failed:",n),t.saveUserInfo({username:b.value.trim(),avatar:E.value||null}),O.value=!1,b.value="",E.value="",w.value=[],P("Peer 连接失败，某些功能可能不可用","warning")}finally{h.value=!1}}const U=p(!1),ie=async o=>{if(o.file.status==="uploading"){U.value=!0;return}if(o.file.status==="done"){U.value=!1;return}o.file.status==="removed"&&(E.value="",w.value=[])},ce=async o=>{if(!o.type.startsWith("image/")||!(o.size/1024/1024<2))return!1;try{const f=await ze(o);E.value=f,w.value=[{uid:"1",name:o.name,status:"done",url:f}]}catch(f){console.error("Avatar processing error:",f)}return!1};return(o,n)=>{const L=i("a-avatar"),f=i("a-button"),M=i("a-upload"),S=i("a-typography-text"),R=i("a-form-item"),$=i("a-input"),X=i("a-form"),de=i("a-modal"),Y=i("a-menu-item"),Z=i("a-menu"),fe=i("a-layout-sider"),ve=i("a-layout-header"),me=i("a-drawer"),_e=i("router-view"),pe=i("a-layout-content"),ge=i("a-col"),ye=i("a-row"),be=i("a-layout-footer"),he=i("a-layout");return v(),g(he,{class:"responsive-layout"},{default:l(()=>[r(de,{open:O.value,"onUpdate:open":n[1]||(n[1]=u=>O.value=u),title:"设置用户信息",footer:null,closable:!1,"mask-closable":!1},{default:l(()=>[r(X,{layout:"vertical"},{default:l(()=>[r(R,{label:"头像"},{default:l(()=>[d("div",De,[r(L,{src:re.value,size:80},{default:l(()=>[y(m(b.value.charAt(0).toUpperCase()||"U"),1)]),_:1},8,["src"]),r(M,{"file-list":w.value,"before-upload":ce,onChange:ie,"max-count":1,"list-type":"picture",accept:"image/*",disabled:U.value||h.value},{default:l(()=>[w.value.length===0?(v(),g(f,{key:0,loading:U.value,disabled:h.value,"aria-label":"upload-avatar"},{icon:l(()=>[r(_(Se))]),default:l(()=>[n[4]||(n[4]=y(" 上传头像 ",-1))]),_:1},8,["loading","disabled"])):B("",!0)]),_:1},8,["file-list","disabled"]),r(S,{type:"secondary",style:{"font-size":"12px"}},{default:l(()=>[...n[5]||(n[5]=[y(" 支持 jpg、png 格式，不超过 2MB ",-1)])]),_:1}),C.value?(v(),k("div",{key:0,class:te(["inline-message",`inline-message-${K.value}`])},m(C.value),3)):B("",!0)])]),_:1}),r(R,{label:"用户名",required:""},{default:l(()=>[r($,{value:b.value,"onUpdate:value":n[0]||(n[0]=u=>b.value=u),placeholder:"请输入用户名（2-20个字符）",maxlength:20,disabled:h.value,onKeyup:Pe(Q,["enter"])},null,8,["value","disabled"])]),_:1}),r(R,null,{default:l(()=>[r(f,{type:"primary",block:"",loading:h.value,disabled:h.value,onClick:Q,"aria-label":"complete-user-setup"},{default:l(()=>[...n[6]||(n[6]=[y(" 完成 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),A.value?(v(),k("div",Fe,[r(ve,{class:"mobile-header"},{default:l(()=>[d("div",We,m(se.value),1),r(f,{type:"text",onClick:n[2]||(n[2]=u=>I.value=!0),"aria-label":"open-menu"},{icon:l(()=>[r(_(F))]),_:1})]),_:1}),r(me,{open:I.value,"onUpdate:open":n[3]||(n[3]=u=>I.value=u),placement:"left",closable:!1,class:"mobile-drawer"},{default:l(()=>[n[8]||(n[8]=d("div",{class:"logo-section"},[d("div",{class:"logo"},"P2P 聊天")],-1)),r(Z,{selectedKeys:[z.value],mode:"inline",theme:"dark"},{default:l(()=>[(v(),k(V,null,D(T,u=>r(Y,{key:u.key,onClick:ee=>j(u.route)},{icon:l(()=>[(v(),g(N(u.icon)))]),default:l(()=>[y(" "+m(u.label),1)]),_:2},1032,["onClick"])),64))]),_:1},8,["selectedKeys"]),d("div",qe,[r(L,{size:48,src:_(t).userInfo.avatar},{default:l(()=>[y(m(_(t).userInfo.username?.charAt(0)),1)]),_:1},8,["src"]),d("div",Je,[d("div",Ke,m(_(t).userInfo.username),1),d("div",Qe,m(J(_(t).myPeerId)),1)])])]),_:1},8,["open"])])):(v(),g(fe,{key:0,width:"240",class:"pc-sider"},{default:l(()=>[n[7]||(n[7]=d("div",{class:"logo-section"},[d("div",{class:"logo"},"P2P 聊天")],-1)),r(Z,{selectedKeys:[z.value],mode:"inline",theme:"dark",class:"side-menu"},{default:l(()=>[(v(),k(V,null,D(T,u=>r(Y,{key:u.key,onClick:ee=>j(u.route)},{icon:l(()=>[(v(),g(N(u.icon)))]),default:l(()=>[y(" "+m(u.label),1)]),_:2},1032,["onClick"])),64))]),_:1},8,["selectedKeys"]),d("div",Ne,[r(L,{size:48,src:_(t).userInfo.avatar},{default:l(()=>[y(m(_(t).userInfo.username?.charAt(0)),1)]),_:1},8,["src"]),d("div",Ve,[d("div",He,m(_(t).userInfo.username),1),d("div",Ge,m(J(_(t).myPeerId)),1)])])]),_:1})),r(pe,{class:"main-content"},{default:l(()=>[r(_e)]),_:1}),A.value?(v(),g(be,{key:2,class:"mobile-footer"},{default:l(()=>[r(ye,{type:"flex",justify:"space-around"},{default:l(()=>[(v(!0),k(V,null,D(_(le),u=>(v(),g(ge,{key:u.key,span:6,class:te(["footer-item",{active:z.value===u.key}]),onClick:ee=>j(u.route)},{default:l(()=>[(v(),g(N(u.icon),{class:"footer-icon"})),d("span",Xe,m(u.label),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})):B("",!0)]),_:1})}}}),lt=Ce(Ye,[["__scopeId","data-v-67e3d8b4"]]);export{lt as default};
