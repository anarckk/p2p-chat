import{c as r,I as ne,d as Xe,o as Ye,a as fe,k as O,w as n,r as x,e as p,f as y,h as s,t as b,i as v,b as C,g,P as Ze,n as ee,j as h,q as te,x as et,R as tt,m as nt,u as rt,s as $}from"./index-BIiVSCif.js";import{u as at,a as ot}from"./PeerHttpUtil-m59UYI9_.js";import{a as st,u as lt}from"./index-ikIEMzkK.js";import{L as pe}from"./LinkOutlined-CMtgv86P.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logger-CUkP4sI-.js";import"./networkLogDB-BlD6FS5Z.js";import"./cryptoManager-B5C1ax7v.js";var ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"};function ye(u){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?Object(arguments[i]):{},f=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),f.forEach(function(d){ut(u,d,a[d])})}return u}function ut(u,i,a){return i in u?Object.defineProperty(u,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):u[i]=a,u}var re=function(i,a){var f=ye({},i,a.attrs);return r(ne,ye({},f,{icon:ct}),null)};re.displayName="KeyOutlined";re.inheritAttrs=!1;var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function ve(u){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?Object(arguments[i]):{},f=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),f.forEach(function(d){ft(u,d,a[d])})}return u}function ft(u,i,a){return i in u?Object.defineProperty(u,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):u[i]=a,u}var ae=function(i,a){var f=ve({},i,a.attrs);return r(ne,ve({},f,{icon:dt}),null)};ae.displayName="SyncOutlined";ae.inheritAttrs=!1;var pt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824.2 699.9a301.55 301.55 0 00-86.4-60.4C783.1 602.8 812 546.8 812 484c0-110.8-92.4-201.7-203.2-200-109.1 1.7-197 90.6-197 200 0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 00-86.4 60.4C345 754.6 314 826.8 312 903.8a8 8 0 008 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5A226.62 226.62 0 01612 684c60.9 0 118.2 23.7 161.3 66.8C814.5 792 838 846.3 840 904.3c.1 4.3 3.7 7.7 8 7.7h56a8 8 0 008-8.2c-2-77-33-149.2-87.8-203.9zM612 612c-34.2 0-66.4-13.3-90.5-37.5a126.86 126.86 0 01-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4 0 34.2-13.3 66.3-37.5 90.5A127.3 127.3 0 01612 612zM361.5 510.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 01-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.9-1.7-203.3 89.2-203.3 199.9 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 008 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.9-1 6.5-4.7 6-8.7z"}}]},name:"team",theme:"outlined"};function me(u){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?Object(arguments[i]):{},f=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),f.forEach(function(d){yt(u,d,a[d])})}return u}function yt(u,i,a){return i in u?Object.defineProperty(u,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):u[i]=a,u}var oe=function(i,a){var f=me({},i,a.attrs);return r(ne,me({},f,{icon:pt}),null)};oe.displayName="TeamOutlined";oe.inheritAttrs=!1;const vt={class:"center-container"},mt={class:"query-section"},gt={key:0,class:"empty-state"},_t={key:1,class:"refresh-duration"},bt={class:"public-key-display"},wt={class:"private-key-section"},Ct={class:"key-actions"},ht={key:0,class:"warning-section"},kt={class:"action-buttons"},It={class:"public-key-modal-content"},Dt={class:"key-status-section"},Pt={class:"public-key-display-section"},Ot={class:"public-key-box"},xt={class:"public-key-actions"},St={key:0,class:"warning-section"},$t=Xe({__name:"CenterView",setup(u){const i=rt(),a=at(),f=st(),d=ot(),ge=lt(),{isConnected:q,isBootstrap:_e,queryDiscoveredDevices:be,addDiscoveredDevice:se,sendDiscoveryNotification:le,queryUsername:we,checkOnline:ie,requestAllDeviceLists:Ce,requestDeviceList:he,tryBecomeBootstrap:ke}=ge,D=x(""),Q=x(!1),A=x(!1),R=x(""),ce=x("info"),V=x(new Map),L=x(!1),M=x(""),W=x(""),E=x(void 0);function G(t){return V.value.get(t)||{refreshing:!1,duration:null,error:!1}}const T=$(()=>d.allDevices),B=$(()=>a.myPublicKey),Ie=$(()=>a.myPrivateKey),De=$(()=>a.isCryptoInitialized),Pe=$(()=>Z.value.filter(t=>t.peerId!==a.myPeerId&&t.peerId!=="connecting..."&&t.publicKey));function J(t){return t.length<40?t:`${t.substring(0,20)}...${t.substring(t.length-20)}`}const Oe=$(()=>B.value?J(B.value):"加载中...");function X(t){switch(t){case"verified":return"success";case"exchanged":return"processing";case"compromised":return"error";case"pending":return"warning";default:return"default"}}function Y(t){switch(t){case"verified":return"已验证";case"exchanged":return"已交换";case"compromised":return"被攻击";case"pending":return"交换中";default:return"未交换"}}async function xe(){B.value&&(await navigator.clipboard.writeText(B.value),console.log("[CenterView] Public key copied"))}async function Se(t){const e=d.getDevice(t);e?.publicKey&&(await navigator.clipboard.writeText(e.publicKey),console.log("[CenterView] Device public key copied:",t))}async function $e(t){const e=d.getDevice(t);e&&(e.keyExchangeStatus="verified",await d.addOrUpdateDevice(e),console.log("[CenterView] Device trusted:",t))}async function ze(t){await d.removeDevice(t),console.log("[CenterView] Device removed as compromised:",t)}async function Ke(){try{await a.regenerateCryptoKeys(),console.log("[CenterView] Keys regenerated")}catch(t){console.error("[CenterView] Failed to regenerate keys:",t)}}const U=$(()=>a.userInfo.username?{peerId:a.myPeerId||"connecting...",username:a.userInfo.username||a.myPeerId||"Unknown",avatar:a.userInfo.avatar||null,lastHeartbeat:Date.now(),firstDiscovered:Date.now(),isOnline:!0}:null),Z=$(()=>{const t=[...T.value];if(U.value){const e=U.value.peerId,c=t.findIndex(l=>l.peerId===e);c>=0?t[c]={...t[c],username:U.value.username,avatar:U.value.avatar,lastHeartbeat:Date.now()}:t.push(U.value)}return t.sort((e,c)=>c.lastHeartbeat-e.lastHeartbeat)});function Me(t){return f.getContact(t)!==void 0}Ye(async()=>{await a.loadUserInfo(),console.log("[Center] User info loaded:",{username:a.userInfo.username,avatarLength:a.userInfo.avatar?.length||0,myPeerId:a.myPeerId});const t=performance.now();console.log("[Center-Performance] ===== 组件开始挂载 ====="),console.log("[Center-Performance] Timestamp:",Date.now());const e=(P,K)=>{const j=performance.now(),H=Math.round(j-t);console.log(`[Center-Performance] [${P}] +${H}ms ${K}`),window.__performanceLogs||(window.__performanceLogs=[]),window.__performanceLogs.push({timestamp:Date.now(),phase:P,duration:H,message:K})};e("start","组件开始挂载"),e("before-bootstrap","准备成为宇宙启动者");const c=performance.now();ke(),e("after-bootstrap",`成为宇宙启动者调用完成 (耗时 ${Math.round(performance.now()-c)}ms)`),e("before-load-devices","准备加载设备列表");const l=performance.now();await d.loadDevices(),e("after-load-devices",`设备列表加载完成 (耗时 ${Math.round(performance.now()-l)}ms)`),e("before-load-chat","准备加载聊天数据");const m=performance.now();f.loadFromStorage(),e("after-load-chat",`聊天数据加载完成 (耗时 ${Math.round(performance.now()-m)}ms)`),e("before-heartbeat","准备启动心跳定时器");const k=a.loadDeviceCheckInterval(),I=a.loadDeviceCheckTimeout()*1e3;d.startHeartbeatTimer(async P=>{if(!q.value)return!1;try{return await ie(P.peerId,I)}catch(K){return console.error("[Center] Heartbeat check error:",K),!1}},k),e("after-heartbeat","心跳定时器启动完成");const z=()=>{console.log("[Center] Discovery devices updated, refreshing..."),d.updateOnlineStatus(),d.allDevices.forEach(P=>{f.getContact(P.peerId)&&f.setContactOnline(P.peerId,P.isOnline??!1)})};window.addEventListener("discovery-devices-updated",z),e("event-listeners","事件监听器注册完成"),fe(()=>{window.removeEventListener("discovery-devices-updated",z)}),e("complete","组件挂载完成");const _=Math.round(performance.now()-t);console.log("[Center-Performance] ===== 组件挂载完成 ====="),console.log("[Center-Performance] 总耗时:",_,"ms")}),fe(()=>{});function w(t,e="info"){R.value=t,ce.value=e}function N(){R.value=""}async function ue(){if(N(),!D.value.trim()){w("请输入要查询的 Peer ID","warning");return}Q.value=!0;try{const t=await be(D.value.trim());t.length>0?w(`从 ${D.value} 发现了 ${t.length} 个设备`,"success"):w("未发现任何设备","info"),D.value=""}catch(t){console.error("[Center] Query error:",t),w("查询失败","error")}finally{Q.value=!1}}async function Ee(){if(N(),!D.value.trim()){w("请输入要添加的 Peer ID","warning");return}const t=D.value.trim();if(T.value.find(l=>l.peerId===t)){w("该设备已存在","info"),console.log("[Center] Device already exists, but sending discovery notification anyway:",t);try{await le(t),console.log("[Center] Discovery notification sent to existing device:",t)}catch(l){console.error("[Center] Error sending discovery notification:",l)}D.value="";return}console.log("[Center] Adding device manually:",t);const c={peerId:t,username:t,avatar:null,lastHeartbeat:Date.now(),firstDiscovered:Date.now(),isOnline:!0};se(c),console.log("[Center] Device added to store:",c),console.log("[Center] Sending discovery notification to:",t);try{await le(t),console.log("[Center] Discovery notification sent to:",t)}catch(l){console.error("[Center] Error sending discovery notification:",l)}w(`已添加设备 ${t}`,"success"),D.value="",he(t).then(l=>{l.length>0&&console.log("[Center] Discovered "+l.length+" devices from "+t)}).catch(l=>{console.error("[Center] Request device list error:",l)}),console.log("[Center] About to query username for:",t),we(t).then(l=>{l?(console.log("[Center] Received user info:",l),c.username=l.username,c.avatar=l.avatar,se({...c}),d.addOrUpdateDevice({...c})):(console.warn("[Center] Failed to get user info for:",t),d.addOrUpdateDevice({...c}))}).catch(l=>{console.error("[Center] Error querying username:",l)})}function Te(t){f.createChat(t.peerId,t.username),w(`已添加 ${t.username} 到聊天列表`,"success")}function Ue(t){N(),navigator.clipboard.writeText(t),w("已复制到剪贴板","success")}function je(t){if(!t.publicKey){w("该设备暂无公钥信息","warning");return}M.value=t.publicKey,W.value=t.username,E.value=t.keyExchangeStatus,L.value=!0}async function qe(){M.value&&(await navigator.clipboard.writeText(M.value),w("公钥已复制到剪贴板","success"))}function Ae(){L.value=!1,M.value="",W.value="",E.value=void 0}async function Re(){N(),console.log("[Center] Refresh discovery started"),A.value=!0;try{q.value||console.warn("[Center] Not connected to Peer Server"),a.myPeerId||console.warn("[Center] User info not set");const t=T.value.filter(c=>c.peerId!==a.myPeerId);t.forEach(c=>{V.value.set(c.peerId,{refreshing:!0,duration:null,error:!1})});try{await Ce()}catch(c){console.error("[Center] Request device lists error:",c)}A.value=!1;const e=t.map(async c=>{const l=Date.now(),m=c.peerId;try{const k=await ie(m),I=Date.now()-l;return d.updateDeviceOnlineStatus(m,k),f.getContact(m)&&f.setContactOnline(m,k),V.value.set(m,{refreshing:!1,duration:I,error:!1}),console.log("[Center] Device "+m+" checked: online="+k+", duration="+I+"ms"),{peerId:m,isOnline:k,duration:I}}catch(k){return console.warn("[Center] Check online failed for "+m+":",k),V.value.set(m,{refreshing:!1,duration:null,error:!0}),{peerId:m,isOnline:!1,duration:null}}});Promise.allSettled(e).then(c=>{const l=c.filter(m=>m.status==="fulfilled"&&m.value.isOnline).length;console.log("[Center] Refresh completed: "+T.value.length+" devices, "+l+" online"),w(`已刷新，当前发现 ${T.value.length} 个设备，其中 ${l} 个在线`,"success")})}catch(t){console.error("[Center] Refresh error:",t),w("刷新失败","error"),A.value=!1}}return(t,e)=>{const c=p("a-descriptions-item"),l=p("a-typography-text"),m=p("a-badge"),k=p("a-descriptions"),I=p("a-card"),z=p("a-col"),_=p("a-button"),P=p("a-input"),K=p("a-input-group"),j=p("a-typography-paragraph"),H=p("a-empty"),Ve=p("a-avatar"),S=p("a-tag"),Le=p("a-card-meta"),Be=p("a-list-item"),Ne=p("a-list"),He=p("a-divider"),Fe=p("a-collapse-panel"),Qe=p("a-collapse"),We=p("a-space"),de=p("a-alert"),Ge=p("a-row"),Je=p("a-modal");return y(),O("div",vt,[r(Ge,{gutter:[16,16]},{default:n(()=>[r(z,{xs:24,md:8},{default:n(()=>[r(I,{title:"我的信息",bordered:!1},{default:n(()=>[r(k,{column:1},{default:n(()=>[r(c,{label:"用户名"},{default:n(()=>[s(b(v(a).userInfo.username||"未设置"),1)]),_:1}),r(c,{label:"我的 Peer ID"},{default:n(()=>[v(a).myPeerId?(y(),C(l,{key:0,copyable:"","copy-text":v(a).myPeerId,onCopy:e[0]||(e[0]=o=>Ue(v(a).myPeerId))},{default:n(()=>[s(b(v(a).myPeerId),1)]),_:1},8,["copy-text"])):(y(),C(l,{key:1,type:"secondary"},{default:n(()=>[...e[4]||(e[4]=[s("连接中...",-1)])]),_:1}))]),_:1}),r(c,{label:"连接状态"},{default:n(()=>[r(m,{status:v(q)?"processing":"error",text:v(q)?"已连接":"未连接"},null,8,["status","text"])]),_:1})]),_:1})]),_:1})]),_:1}),r(z,{xs:24,md:16},{default:n(()=>[r(I,{title:"发现中心",bordered:!1},{extra:n(()=>[r(_,{size:"small",loading:A.value,onClick:Re,"aria-label":"refresh-discovery"},{icon:n(()=>[r(v(tt))]),default:n(()=>[e[5]||(e[5]=s(" 刷新 ",-1))]),_:1},8,["loading"])]),default:n(()=>[g("div",mt,[r(K,{compact:""},{default:n(()=>[r(P,{value:D.value,"onUpdate:value":e[1]||(e[1]=o=>D.value=o),placeholder:"输入对方 Peer ID 进行查询或添加",style:{width:"calc(100% - 130px)"},onPressEnter:ue},null,8,["value"]),r(_,{type:"primary",onClick:ue,loading:Q.value,"aria-label":"query-devices-button"},{default:n(()=>[...e[6]||(e[6]=[s(" 查询 ",-1)])]),_:1},8,["loading"]),r(_,{onClick:Ee,"aria-label":"add-device"},{icon:n(()=>[r(v(Ze))]),default:n(()=>[e[7]||(e[7]=s(" 添加 ",-1))]),_:1})]),_:1}),R.value?(y(),O("div",{key:0,class:ee(["inline-message",`inline-message-${ce.value}`])},b(R.value),3)):h("",!0)]),Z.value.length===0?(y(),O("div",gt,[r(H,{description:"暂无在线设备"},{image:n(()=>[r(v(oe),{style:{"font-size":"64px",color:"#ccc"}})]),default:n(()=>[r(j,{type:"secondary"},{default:n(()=>[...e[8]||(e[8]=[g("p",null,"去中心化发现中心使用说明：",-1)])]),_:1}),r(j,{type:"secondary",style:{"font-size":"12px"}},{default:n(()=>[...e[9]||(e[9]=[s(' 1. 输入已知设备的 Peer ID 点击"查询"，向该设备询问它已发现的设备',-1),g("br",null,null,-1),s(' 2. 输入新的 Peer ID 点击"添加"，直接将该设备添加到发现列表',-1),g("br",null,null,-1),s(" 3. 每个节点都是发现中心，可以互相询问已发现的设备",-1),g("br",null,null,-1),s(" 4. 设备列表会自动保存，刷新页面后依然保留",-1),g("br",null,null,-1),s(" 5. 超过3天未在线的设备会自动删除 ",-1)])]),_:1})]),_:1})])):(y(),C(Ne,{key:1,"data-source":Z.value,grid:{gutter:16,xs:1,sm:2,md:2}},{renderItem:n(({item:o})=>[r(Be,null,{default:n(()=>[r(I,{hoverable:"",size:"small",class:ee(["device-card",{"is-me":o.peerId===v(a).myPeerId||o.peerId==="connecting...","is-offline":!o.isOnline}]),onClick:F=>o.peerId!==v(a).myPeerId&&o.peerId!=="connecting..."&&Te(o)},{actions:n(()=>[r(m,{status:o.isOnline?"processing":"default",text:o.isOnline?"在线":"离线"},null,8,["status","text"]),o.peerId!==v(a).myPeerId&&o.peerId!=="connecting..."&&o.publicKey?(y(),C(_,{key:0,type:"text",size:"small",onClick:et(F=>je(o),["stop"]),"aria-label":"view-public-key"},{icon:n(()=>[r(v(re))]),default:n(()=>[e[16]||(e[16]=s(" 查看公钥 ",-1))]),_:1},8,["onClick"])):h("",!0)]),default:n(()=>[r(Le,null,{avatar:n(()=>[r(Ve,{src:o.avatar||void 0,size:48},{default:n(()=>[s(b(o.username.charAt(0).toUpperCase()),1)]),_:2},1032,["src"])]),title:n(()=>[s(b(o.username)+" ",1),o.peerId===v(a).myPeerId?(y(),C(S,{key:0,color:"blue",size:"small"},{default:n(()=>[...e[10]||(e[10]=[s("我",-1)])]),_:1})):h("",!0),o.peerId===v(a).myPeerId&&v(_e)?(y(),C(S,{key:1,color:"purple",size:"small"},{default:n(()=>[...e[11]||(e[11]=[s("宇宙启动者",-1)])]),_:1})):h("",!0),o.peerId!==v(a).myPeerId&&o.peerId!=="connecting..."?(y(),O(te,{key:2},[o.isBootstrap?(y(),C(S,{key:0,color:"purple",size:"small"},{default:n(()=>[...e[12]||(e[12]=[s("宇宙启动者",-1)])]),_:1})):h("",!0),Me(o.peerId)?(y(),C(S,{key:1,color:"green",size:"small"},{default:n(()=>[...e[13]||(e[13]=[s("聊天中",-1)])]),_:1})):h("",!0),o.isOnline?(y(),C(S,{key:2,color:"success",size:"small"},{default:n(()=>[...e[14]||(e[14]=[s("在线",-1)])]),_:1})):(y(),C(S,{key:3,color:"default",size:"small"},{default:n(()=>[...e[15]||(e[15]=[s("离线",-1)])]),_:1})),o.keyExchangeStatus?(y(),C(S,{key:4,color:X(o.keyExchangeStatus),size:"small",class:ee(`key-exchange-status-${o.keyExchangeStatus}`)},{default:n(()=>[s(b(Y(o.keyExchangeStatus)),1)]),_:2},1032,["color","class"])):h("",!0),o.isOnline?(y(),O(te,{key:5},[G(o.peerId).refreshing?(y(),C(v(ae),{key:0,spin:"",style:{color:"#1890ff","margin-left":"4px"}})):G(o.peerId).duration!==null?(y(),O("span",_t,b(G(o.peerId).duration)+"ms",1)):h("",!0)],64)):h("",!0)],64)):h("",!0)]),description:n(()=>[r(l,{type:"secondary",style:{"font-size":"12px"}},{default:n(()=>[s(b(o.peerId),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024)]),_:1},8,["data-source"]))]),_:1})]),_:1}),r(z,{xs:24,md:16,offset:De.value?8:0},{default:n(()=>[r(He,null,{default:n(()=>[...e[17]||(e[17]=[s("身份安全",-1)])]),_:1}),r(I,{title:"我的公钥",size:"small"},{extra:n(()=>[r(_,{type:"link",onClick:xe,"aria-label":"copy-public-key"},{default:n(()=>[...e[18]||(e[18]=[s(" 复制 ",-1)])]),_:1})]),default:n(()=>[g("div",bt,[r(l,{code:"",copyable:""},{default:n(()=>[s(b(Oe.value),1)]),_:1})]),g("div",wt,[r(Qe,null,{default:n(()=>[r(Fe,{header:"查看私钥（请勿泄露）"},{default:n(()=>[r(l,{code:""},{default:n(()=>[s(b(Ie.value||"未初始化"),1)]),_:1})]),_:1})]),_:1})]),g("div",Ct,[r(_,{type:"primary",danger:"",size:"small",onClick:Ke,"aria-label":"regenerate-keys"},{default:n(()=>[...e[19]||(e[19]=[s(" 重新生成密钥 ",-1)])]),_:1}),r(_,{type:"link",size:"small",onClick:e[2]||(e[2]=o=>v(i).push("/settings")),"aria-label":"go-to-settings-for-keys"},{icon:n(()=>[r(v(pe))]),default:n(()=>[e[20]||(e[20]=s(" 在设置页面查看详细信息 ",-1))]),_:1})])]),_:1}),(y(!0),O(te,null,nt(Pe.value,o=>(y(),O("div",{key:o.peerId,class:"device-key-section"},[r(I,{title:`${o.username} 的公钥`,size:"small"},{extra:n(()=>[r(We,null,{default:n(()=>[r(S,{color:X(o.keyExchangeStatus)},{default:n(()=>[s(b(Y(o.keyExchangeStatus)),1)]),_:2},1032,["color"]),r(_,{type:"link",size:"small",onClick:F=>Se(o.peerId),"aria-label":`copy-device-public-key-${o.peerId}`},{default:n(()=>[...e[21]||(e[21]=[s(" 复制 ",-1)])]),_:1},8,["onClick","aria-label"])]),_:2},1024)]),default:n(()=>[r(l,{code:""},{default:n(()=>[s(b(J(o.publicKey||"")),1)]),_:2},1024),o.keyExchangeStatus==="compromised"?(y(),O("div",ht,[r(de,{type:"warning",message:"安全警告",description:"此设备的公钥已发生变化，可能存在中间人攻击。请确认对方身份后再决定是否信任。","show-icon":""}),g("div",kt,[r(_,{type:"primary",size:"small",onClick:F=>$e(o.peerId),"aria-label":`trust-device-${o.peerId}`},{default:n(()=>[...e[22]||(e[22]=[s(" 信任此设备 ",-1)])]),_:1},8,["onClick","aria-label"]),r(_,{danger:"",size:"small",onClick:F=>ze(o.peerId),"aria-label":`remove-device-${o.peerId}`},{default:n(()=>[...e[23]||(e[23]=[s(" 移除 ",-1)])]),_:1},8,["onClick","aria-label"])])])):h("",!0)]),_:2},1032,["title"])]))),128))]),_:1},8,["offset"])]),_:1}),r(Je,{open:L.value,"onUpdate:open":e[3]||(e[3]=o=>L.value=o),title:`${W.value} 的公钥`,footer:null,width:"600px","aria-label":"device-public-key-modal"},{footer:n(()=>[r(_,{onClick:Ae,"aria-label":"close-public-key-modal"},{default:n(()=>[...e[26]||(e[26]=[s(" 关闭 ",-1)])]),_:1})]),default:n(()=>[g("div",It,[g("div",Dt,[r(k,{column:1,size:"small"},{default:n(()=>[r(c,{label:"密钥交换状态"},{default:n(()=>[r(S,{color:X(E.value)},{default:n(()=>[s(b(Y(E.value)),1)]),_:1},8,["color"])]),_:1})]),_:1})]),g("div",Pt,[r(j,null,{default:n(()=>[r(l,{type:"secondary"},{default:n(()=>[...e[24]||(e[24]=[s("公钥（SHA-256）：",-1)])]),_:1})]),_:1}),g("div",Ot,[r(l,{code:"",class:"public-key-text"},{default:n(()=>[s(b(J(M.value)),1)]),_:1})]),g("div",xt,[r(_,{type:"primary",size:"small",onClick:qe,"aria-label":"copy-public-key-from-modal"},{icon:n(()=>[r(v(pe))]),default:n(()=>[e[25]||(e[25]=s(" 复制公钥 ",-1))]),_:1})])]),E.value==="compromised"?(y(),O("div",St,[r(de,{type:"warning",message:"安全警告",description:"此设备的公钥已发生变化，可能存在中间人攻击。请确认对方身份后再决定是否信任。","show-icon":""})])):h("",!0)])]),_:1},8,["open","title"])])}}}),At=it($t,[["__scopeId","data-v-a4ddece1"]]);export{At as default};
