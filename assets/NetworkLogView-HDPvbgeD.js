import{n as U}from"./networkLogDB-bSBVLm5N.js";import{c as a,I as Q,d as re,o as le,k as _,g as m,i as v,v as ie,h as f,w as n,r as b,e as p,f as r,t as g,b as w,F as E,Q as P,j,R as ue,D as ce}from"./index-Dh4fjBfC.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";var pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};function M(l){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},d=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(o).filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable}))),d.forEach(function(u){fe(l,u,o[u])})}return l}function fe(l,s,o){return s in l?Object.defineProperty(l,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):l[s]=o,l}var A=function(s,o){var d=M({},s,o.attrs);return a(Q,M({},d,{icon:pe}),null)};A.displayName="ArrowDownOutlined";A.inheritAttrs=!1;var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"};function J(l){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},d=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(o).filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable}))),d.forEach(function(u){ye(l,u,o[u])})}return l}function ye(l,s,o){return s in l?Object.defineProperty(l,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):l[s]=o,l}var B=function(s,o){var d=J({},s,o.attrs);return a(Q,J({},d,{icon:ge}),null)};B.displayName="ArrowUpOutlined";B.inheritAttrs=!1;const _e={class:"network-log-view"},me={class:"page-header"},ve={class:"page-title"},be={class:"card-title"},we={key:0,class:"timestamp-text"},he={key:1,class:"empty-text"},ke={key:1,class:"empty-text"},xe={key:5,class:"size-text"},Oe={class:"pagination-wrapper"},Se={key:0,class:"detail-content"},ze={key:0,class:"data-container"},Ce={class:"data-size-info"},Le={class:"json-data"},De={key:0,class:"data-container"},Ie={class:"data-size-info"},qe={class:"json-data"},Pe={key:0,class:"error-section"},je=re({__name:"NetworkLogView",setup(l){const s=[{title:"时间",dataIndex:"timestamp",key:"timestamp",width:150},{title:"对端",dataIndex:"peerId",key:"peerId",width:180},{title:"业务类型",dataIndex:"businessType",key:"businessType",width:150},{title:"Request",dataIndex:"request",key:"request",width:80},{title:"Response",dataIndex:"response",key:"response",width:80},{title:"数据大小",dataIndex:"dataSize",key:"dataSize",width:100},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"操作",dataIndex:"actions",key:"actions",width:80,fixed:"right"}],o=b([]),d=b(!1),u=b(1),z=b(20),C=b(0),L=b(!1),c=b(null),k=b("request");async function x(){d.value=!0;try{const e=await U.getLogs(u.value,z.value);o.value=e.data,C.value=e.total}catch(e){console.error("Failed to load logs:",e)}finally{d.value=!1}}function N(e){return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function G(e){return e.length<=20?e:e.substring(0,10)+"..."+e.substring(e.length-7)}function V(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":(e/(1024*1024)).toFixed(2)+" MB"}function O(e){switch(e){case"success":return{text:"成功",color:"green"};case"error":return{text:"错误",color:"red"};case"pending":return{text:"进行中",color:"blue"};default:return{text:e,color:"gray"}}}function D(e){c.value=e,k.value="request",L.value=!0}function T(e){if(!e)return"0 B";const t=JSON.stringify(e),I=new Blob([t]).size;return V(I)}async function H(e){u.value=e,await x()}async function K(){u.value=1,await x()}async function W(){try{await U.clearAllLogs(),u.value=1,await x()}catch(e){console.error("Failed to clear logs:",e)}}return le(()=>{x()}),(e,t)=>{const I=p("a-badge"),q=p("a-button"),X=p("a-space"),Y=p("a-typography-text"),h=p("a-tag"),Z=p("a-table"),ee=p("a-pagination"),te=p("a-card"),S=p("a-descriptions-item"),ae=p("a-descriptions"),R=p("a-empty"),$=p("a-tab-pane"),ne=p("a-tabs"),se=p("a-alert"),oe=p("a-modal");return r(),_("div",_e,[m("div",me,[m("h1",ve,[a(v(ie),{class:"title-icon"}),t[4]||(t[4]=f(" 网络数据日志 ",-1))]),t[5]||(t[5]=m("p",{class:"page-subtitle"},"查看和分析所有网络通信记录",-1))]),a(te,{class:"log-card",bordered:!1},{title:n(()=>[m("div",be,[t[6]||(t[6]=m("span",null,"通信记录",-1)),a(I,{count:C.value,"number-style":{backgroundColor:"#1890ff"},style:{"margin-left":"8px"}},null,8,["count"])])]),extra:n(()=>[a(X,null,{default:n(()=>[a(q,{onClick:K,"aria-label":"refresh-logs"},{icon:n(()=>[a(v(ue))]),default:n(()=>[t[7]||(t[7]=f(" 刷新 ",-1))]),_:1}),a(q,{type:"primary",danger:"",onClick:W,"aria-label":"clear-all-logs"},{icon:n(()=>[a(v(ce))]),default:n(()=>[t[8]||(t[8]=f(" 清空日志 ",-1))]),_:1})]),_:1})]),default:n(()=>[a(Z,{columns:s,"data-source":o.value,loading:d.value,pagination:!1,size:"small",scroll:{x:1200,y:500},class:"log-table"},{bodyCell:n(({column:i,record:y})=>[i.key==="timestamp"?(r(),_("span",we,g(N(y.timestamp)),1)):i.key==="peerId"?(r(),w(Y,{key:1,copyable:"",text:y.peerId,class:"peer-id-text"},{default:n(()=>[f(g(G(y.peerId)),1)]),_:2},1032,["text"])):i.key==="businessType"?(r(),w(h,{key:2,color:"blue"},{default:n(()=>[f(g(y.businessType),1)]),_:2},1024)):i.key==="request"?(r(),_(E,{key:3},[y.request?(r(),w(h,{key:0,color:"green",style:{cursor:"pointer"},onClick:F=>D(y)},{default:n(()=>[a(v(P),{style:{"margin-right":"4px"}}),t[9]||(t[9]=f(" 查看 ",-1))]),_:1},8,["onClick"])):(r(),_("span",he,"-"))],64)):i.key==="response"?(r(),_(E,{key:4},[y.response?(r(),w(h,{key:0,color:"orange",style:{cursor:"pointer"},onClick:F=>{D(y),k.value="response"}},{default:n(()=>[a(v(P),{style:{"margin-right":"4px"}}),t[10]||(t[10]=f(" 查看 ",-1))]),_:1},8,["onClick"])):(r(),_("span",ke,"-"))],64)):i.key==="dataSize"?(r(),_("span",xe,g(V(y.dataSize)),1)):i.key==="status"?(r(),w(h,{key:6,color:O(y.status).color},{default:n(()=>[f(g(O(y.status).text),1)]),_:2},1032,["color"])):i.key==="actions"?(r(),w(q,{key:7,type:"link",size:"small",onClick:F=>D(y),"aria-label":"view-detail"},{default:n(()=>[a(v(P))]),_:1},8,["onClick"])):j("",!0)]),_:1},8,["data-source","loading"]),m("div",Oe,[a(ee,{current:u.value,"onUpdate:current":t[0]||(t[0]=i=>u.value=i),"page-size":z.value,"onUpdate:pageSize":t[1]||(t[1]=i=>z.value=i),total:C.value,"show-total":i=>`共 ${i} 条记录`,"page-size-options":["10","20","50","100"],"show-size-changer":"",onChange:H},null,8,["current","page-size","total","show-total"])])]),_:1}),a(oe,{open:L.value,"onUpdate:open":t[3]||(t[3]=i=>L.value=i),title:`通信详情 - ${c.value?.businessType||""}`,width:"700px",footer:null,class:"detail-modal"},{default:n(()=>[c.value?(r(),_("div",Se,[a(ae,{column:2,size:"small",bordered:"",class:"meta-info"},{default:n(()=>[a(S,{label:"时间"},{default:n(()=>[f(g(N(c.value.timestamp)),1)]),_:1}),a(S,{label:"对端"},{default:n(()=>[f(g(c.value.peerId),1)]),_:1}),a(S,{label:"业务类型"},{default:n(()=>[f(g(c.value.businessType),1)]),_:1}),a(S,{label:"状态"},{default:n(()=>[a(h,{color:O(c.value.status).color},{default:n(()=>[f(g(O(c.value.status).text),1)]),_:1},8,["color"])]),_:1})]),_:1}),a(ne,{activeKey:k.value,"onUpdate:activeKey":t[2]||(t[2]=i=>k.value=i),class:"data-tabs",style:{"margin-top":"16px"}},{default:n(()=>[a($,{key:"request",tab:"Request"},{tab:n(()=>[a(v(B),{style:{"margin-right":"4px"}}),t[11]||(t[11]=f(" Request (请求) ",-1))]),default:n(()=>[c.value.request?(r(),_("div",ze,[m("div",Ce," 数据大小: "+g(T(c.value.request)),1),m("pre",Le,g(JSON.stringify(c.value.request,null,2)),1)])):(r(),w(R,{key:1,description:"无请求数据"}))]),_:1}),a($,{key:"response",tab:"Response"},{tab:n(()=>[a(v(A),{style:{"margin-right":"4px"}}),t[12]||(t[12]=f(" Response (响应) ",-1))]),default:n(()=>[c.value.response?(r(),_("div",De,[m("div",Ie," 数据大小: "+g(T(c.value.response)),1),m("pre",qe,g(JSON.stringify(c.value.response,null,2)),1)])):(r(),w(R,{key:1,description:"无响应数据"}))]),_:1})]),_:1},8,["activeKey"]),c.value.error?(r(),_("div",Pe,[a(se,{type:"error",message:"错误信息",description:c.value.error,"show-icon":""},null,8,["description"])])):j("",!0)])):j("",!0)]),_:1},8,["open","title"])])}}}),Ve=de(je,[["__scopeId","data-v-f4db0cb9"]]);export{Ve as default};
