import{n as S}from"./networkLogDB-BlD6FS5Z.js";import{d as q,o as E,k as u,c,w as n,r as s,e as d,f as r,h as l,g as I,t as i,j as z,q as p,b as k}from"./index-CsO3AHyv.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"network-log-view"},O={key:0,style:{color:"red","margin-top":"8px"}},G={style:{background:"#f5f5f5",padding:"12px","border-radius":"4px","max-height":"500px",overflow:"auto","font-size":"12px"}},H=q({__name:"NetworkLogView",setup(Q){const D=[{title:"时间",dataIndex:"timestamp",key:"timestamp",width:150},{title:"方向",dataIndex:"direction",key:"direction",width:80},{title:"对端",dataIndex:"peerId",key:"peerId",width:200},{title:"协议",dataIndex:"protocol",key:"protocol",width:150},{title:"阶段",dataIndex:"stage",key:"stage",width:100},{title:"数据大小",dataIndex:"dataSize",key:"dataSize",width:100},{title:"状态",dataIndex:"status",key:"status",width:80}],x=s([]),f=s(!1),g=s(1),y=s(20),v=s(0),m=s(!1),w=s(null),B=s(null);async function _(){f.value=!0;try{const t=await S.getLogs(g.value,y.value);x.value=t.data,v.value=t.total}catch(t){console.error("Failed to load logs:",t)}finally{f.value=!1}}function L(t){return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function N(t){return t==="outgoing"?"发送":"接收"}function V(t){return t.length<=20?t:t.substring(0,10)+"..."+t.substring(t.length-7)}function F(t){return t<1024?t+" B":t<1024*1024?(t/1024).toFixed(2)+" KB":(t/(1024*1024)).toFixed(2)+" MB"}function h(t){switch(t){case"success":return{text:"成功",color:"green"};case"error":return{text:"错误",color:"red"};case"pending":return{text:"进行中",color:"blue"};default:return{text:t,color:"gray"}}}function P(t){B.value=t,w.value=JSON.stringify(t.data,null,2),m.value=!0}async function U(t){g.value=t,await _()}async function A(){try{await S.clearAllLogs(),g.value=1,await _()}catch(t){console.error("Failed to clear logs:",t)}}return E(()=>{_()}),(t,a)=>{const b=d("a-button"),C=d("a-tag"),M=d("a-typography-text"),R=d("a-table"),T=d("a-pagination"),$=d("a-card"),j=d("a-modal");return r(),u("div",K,[c($,{title:"网络数据日志",bordered:!1},{extra:n(()=>[c(b,{type:"primary",danger:"",onClick:A,"aria-label":"清空所有日志"},{default:n(()=>[...a[3]||(a[3]=[l(" 清空日志 ",-1)])]),_:1})]),default:n(()=>[c(R,{columns:D,"data-source":x.value,loading:f.value,pagination:!1,size:"small",scroll:{y:500}},{bodyCell:n(({column:e,record:o})=>[e.key==="timestamp"?(r(),u(p,{key:0},[l(i(L(o.timestamp)),1)],64)):e.key==="direction"?(r(),k(C,{key:1,color:o.direction==="outgoing"?"blue":"green"},{default:n(()=>[l(i(N(o.direction)),1)]),_:2},1032,["color"])):e.key==="peerId"?(r(),k(M,{key:2,copyable:"",text:o.peerId},{default:n(()=>[l(i(V(o.peerId)),1)]),_:2},1032,["text"])):e.key==="protocol"?(r(),u(p,{key:3},[l(i(o.protocol),1)],64)):e.key==="stage"?(r(),u(p,{key:4},[l(i(o.stage||"-"),1)],64)):e.key==="dataSize"?(r(),u(p,{key:5},[l(i(F(o.dataSize)),1)],64)):e.key==="status"?(r(),k(C,{key:6,color:h(o.status).color},{default:n(()=>[l(i(h(o.status).text),1)]),_:2},1032,["color"])):z("",!0)]),expandedRowRender:n(({record:e})=>[c(b,{type:"link",size:"small",onClick:o=>P(e),"aria-label":"查看数据详情"},{default:n(()=>[...a[4]||(a[4]=[l(" 查看数据详情 ",-1)])]),_:1},8,["onClick"]),e.error?(r(),u("div",O,[a[5]||(a[5]=I("strong",null,"错误信息:",-1)),l(" "+i(e.error),1)])):z("",!0)]),_:1},8,["data-source","loading"]),c(T,{current:g.value,"onUpdate:current":a[0]||(a[0]=e=>g.value=e),"page-size":y.value,"onUpdate:pageSize":a[1]||(a[1]=e=>y.value=e),total:v.value,"show-total":e=>`共 ${e} 条`,onChange:U,style:{"margin-top":"16px","text-align":"right"}},null,8,["current","page-size","total","show-total"])]),_:1}),c(j,{open:m.value,"onUpdate:open":a[2]||(a[2]=e=>m.value=e),title:"数据详情",footer:null,width:"800px"},{default:n(()=>[I("pre",G,i(w.value),1)]),_:1},8,["open"])])}}}),Z=J(H,[["__scopeId","data-v-a6305bd5"]]);export{Z as default};
