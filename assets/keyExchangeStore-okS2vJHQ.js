import{K as b,r as s}from"./index-CsO3AHyv.js";const K=b("keyExchange",()=>{const n=s({visible:!1,peerId:"",username:"",oldPublicKey:"",newPublicKey:""}),l=s(new Map);function u(e,o,r,a){return new Promise(h=>{if(n.value.visible){l.value.set(e,{visible:!1,peerId:e,username:o,oldPublicKey:r,newPublicKey:a}),console.log("[KeyExchangeStore] Dialog queued for:",e);return}n.value={visible:!0,peerId:e,username:o,oldPublicKey:r,newPublicKey:a,resolve:h},console.log("[KeyExchangeStore] Showing dialog for:",e)})}function c(){const e=n.value;e.resolve&&e.resolve(!1),i(),t()}function g(){const e=n.value;e.resolve&&e.resolve(!0),i(),t()}function i(){n.value={visible:!1,peerId:"",username:"",oldPublicKey:"",newPublicKey:""}}function t(){if(l.value.size===0)return;const e=l.value.entries().next();if(e.done)return;const[o,r]=e.value;l.value.delete(o),n.value={...r,visible:!0},console.log("[KeyExchangeStore] Processing next dialog for:",o)}function v(e){n.value.peerId===e&&n.value.visible?(n.value.resolve&&n.value.resolve(!1),i(),t()):l.value.delete(e)}function f(){l.value.clear(),i()}function d(e){return e.length<40?e:`${e.substring(0,20)}...${e.substring(e.length-20)}`}return{dialog:n,pendingChanges:l,showKeyChangeDialog:u,handleNotTrust:c,handleTrust:g,cancelPendingDialog:v,clearAllPending:f,truncateKey:d}});export{K as useKeyExchangeStore};
