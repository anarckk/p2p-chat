import{c as n,I as H,d as de,o as fe,x as pe,k as K,w as l,r as u,e as d,f as k,g as s,a as S,h as y,t as N,j as F,i as x,F as ge,G as me,n as be,u as he,s as _e}from"./index-Dh8JxQg4.js";import{u as we,a as ke}from"./index-C-8vRXzh.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PeerHttpUtil-D_AN6ldI.js";import"./networkLogDB-BlD6FS5Z.js";var Oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};function ee(o){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?Object(arguments[a]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),r.forEach(function(i){Se(o,i,t[i])})}return o}function Se(o,a,t){return a in o?Object.defineProperty(o,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[a]=t,o}var E=function(a,t){var r=ee({},a,t.attrs);return n(H,ee({},r,{icon:Oe}),null)};E.displayName="SaveOutlined";E.inheritAttrs=!1;var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z"}}]},name:"thunderbolt",theme:"outlined"};function te(o){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?Object(arguments[a]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),r.forEach(function(i){xe(o,i,t[i])})}return o}function xe(o,a,t){return a in o?Object.defineProperty(o,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[a]=t,o}var R=function(a,t){var r=te({},a,t.attrs);return n(H,te({},r,{icon:Ce}),null)};R.displayName="ThunderboltOutlined";R.inheritAttrs=!1;var Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"};function ae(o){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?Object(arguments[a]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),r.forEach(function(i){Ue(o,i,t[i])})}return o}function Ue(o,a,t){return a in o?Object.defineProperty(o,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[a]=t,o}var G=function(a,t){var r=ae({},a,t.attrs);return n(H,ae({},r,{icon:Ie}),null)};G.displayName="UserOutlined";G.inheritAttrs=!1;const Pe={class:"settings-container"},ze={class:"avatar-section"},Ae={class:"avatar-actions"},Me={class:"network-acceleration-section"},Ne={class:"status-info"},Ve={class:"network-logging-section"},je={class:"status-info"},Le={style:{"margin-top":"8px"}},De={class:"device-check-section"},Te={class:"status-info"},Be={class:"action-buttons"},$e=de({__name:"SettingsView",setup(o){const a=he(),t=we(),r=ke(),{setNetworkAccelerationEnabled:i,broadcastNetworkAccelerationStatus:ne,broadcastUserInfoUpdate:le}=r,f=u(""),I=u(""),p=u(null),U=u(null),B=u(!1),c=u(!1),P=u(!1),g=u(!1),z=u(!1),b=u(20),V=u(20),h=u(5),j=u(5),$=u(!1),L=u(""),J=u("info"),W=u(!1);fe(async()=>{await t.loadUserInfo(),console.log("[SettingsView] userInfo.avatar:",t.userInfo.avatar),f.value=t.userInfo.username||"",I.value=f.value,p.value=t.userInfo.avatar||null,console.log("[SettingsView] avatarPreview set to:",p.value),console.log("[SettingsView] final avatarPreview:",p.value,"type:",typeof p.value),c.value=t.loadNetworkAcceleration(),P.value=c.value,i(c.value),g.value=t.loadNetworkLogging(),z.value=g.value,b.value=t.loadDeviceCheckInterval(),V.value=b.value,h.value=t.loadDeviceCheckTimeout(),j.value=h.value,W.value=!0}),pe(W,v=>{v&&console.log("[SettingsView] userInfoLoaded is true, form initialized")});const q=_e(()=>f.value!==I.value||U.value!==null||B.value||c.value!==P.value||g.value!==z.value||b.value!==V.value||h.value!==j.value);function oe(v){Q();const e=v.file,m=e?.originFileObj||e;if(m&&m instanceof File){if(!m.type.startsWith("image/")){O("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶","error");return}if(m.size>2*1024*1024){O("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB","error");return}U.value=m;const _=new FileReader;_.onload=D=>{p.value=D.target?.result},_.readAsDataURL(m)}}function re(){B.value=!0,p.value=null,U.value=null}async function se(){if(Q(),!f.value.trim()){O("ç”¨æˆ·åä¸èƒ½ä¸ºç©º","warning");return}$.value=!0;try{const v=f.value.trim(),e=p.value;console.log("[Settings] Saving user info:",{newUsername:v,newAvatar:e,currentUsername:t.userInfo.username});const m=v!==I.value,_=e!==t.userInfo.avatar;console.log("[Settings] Changes detected:",{hasUsernameChange:m,hasAvatarChange:_}),await t.saveUserInfo({username:v,avatar:e}),console.log("[Settings] User info saved. Current userStore.userInfo.username:",t.userInfo.username),(m||_)&&(await le(),console.log("[Settings] User info update broadcasted to all devices")),c.value!==P.value&&(t.setNetworkAcceleration(c.value),i(c.value),await ne(),O(c.value?"å·²å¼€å¯ç½‘ç»œåŠ é€Ÿ":"å·²å…³é—­ç½‘ç»œåŠ é€Ÿ","success")),g.value!==z.value&&(t.setNetworkLogging(g.value),O(g.value?"å·²å¼€å¯ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•":"å·²å…³é—­ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•","success")),b.value!==V.value&&(t.setDeviceCheckInterval(b.value),O("è®¾å¤‡çŠ¶æ€æ£€æµ‹é—´éš”å·²æ›´æ–°ä¸º "+b.value+" ç§’","success")),h.value!==j.value&&(t.setDeviceCheckTimeout(h.value),O("è®¾å¤‡çŠ¶æ€æ£€æµ‹è¶…æ—¶å·²æ›´æ–°ä¸º "+h.value+" ç§’","success")),I.value=f.value,P.value=c.value,z.value=g.value,U.value=null,O("è®¾ç½®å·²ä¿å­˜","success"),B.value=!1}catch(v){console.error("[Settings] Save error:",v),O("ä¿å­˜å¤±è´¥","error")}finally{$.value=!1}}function ie(){f.value=I.value,p.value=t.userInfo.avatar,U.value=null,c.value=P.value,g.value=z.value,b.value=V.value,h.value=j.value}function ue(){a.push("/center")}function O(v,e="info"){L.value=v,J.value=e}function Q(){L.value=""}return(v,e)=>{const m=d("a-input"),_=d("a-form-item"),D=d("a-avatar"),C=d("a-button"),ce=d("a-upload"),X=d("a-form"),T=d("a-card"),A=d("a-col"),Y=d("a-switch"),M=d("a-alert"),Z=d("a-input-number"),ve=d("a-row");return k(),K("div",Pe,[n(ve,{gutter:[16,16]},{default:l(()=>[n(A,{xs:24,md:12},{default:l(()=>[n(T,{title:"ç”¨æˆ·ä¿¡æ¯",bordered:!1},{extra:l(()=>[n(x(G))]),default:l(()=>[n(X,{layout:"vertical"},{default:l(()=>[n(_,{label:"ç”¨æˆ·å"},{default:l(()=>[n(m,{value:f.value,"onUpdate:value":e[0]||(e[0]=w=>f.value=w),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",maxlength:20,"show-count":"","allow-clear":""},null,8,["value"])]),_:1}),n(_,{label:"å¤´åƒ"},{default:l(()=>[s("div",ze,[p.value?(k(),S(D,{key:0,size:80,src:p.value},{default:l(()=>[y(N(f.value.charAt(0).toUpperCase()),1)]),_:1},8,["src"])):(k(),S(D,{key:1,size:80},{default:l(()=>[y(N(f.value.charAt(0).toUpperCase()),1)]),_:1})),s("div",Ae,[n(ce,{"before-upload":()=>!1,onChange:oe,"show-upload-list":!1,accept:"image/*"},{default:l(()=>[n(C,{size:"small"},{icon:l(()=>[...e[6]||(e[6]=[y("ğŸ“·",-1)])]),default:l(()=>[e[7]||(e[7]=y(" é€‰æ‹©å›¾ç‰‡ ",-1))]),_:1})]),_:1}),p.value?(k(),S(C,{key:0,size:"small",danger:"",onClick:re,"aria-label":"remove-avatar-button"},{default:l(()=>[...e[8]||(e[8]=[y(" ç§»é™¤ ",-1)])]),_:1})):F("",!0)])]),e[9]||(e[9]=s("div",{class:"avatar-hint"}," æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 2MB ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),n(A,{xs:24,md:12},{default:l(()=>[n(T,{title:"ç½‘ç»œåŠ é€Ÿ",bordered:!1},{extra:l(()=>[n(x(R))]),default:l(()=>[s("div",Me,[e[10]||(e[10]=s("p",{class:"description"}," å¼€å¯ç½‘ç»œåŠ é€Ÿåï¼Œæ‚¨çš„è®¾å¤‡å¯ä»¥å¸®åŠ©å…¶ä»–è®¾å¤‡è½¬å‘æ¶ˆæ¯ã€‚ åŒæ—¶ï¼Œå½“æ‚¨ä¸æŸäº›è®¾å¤‡ç›´è¿å¤±è´¥æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–å¼€å¯ç½‘ç»œåŠ é€Ÿçš„è®¾å¤‡ä¸­è½¬æ¶ˆæ¯ã€‚ ",-1)),n(Y,{checked:c.value,"onUpdate:checked":e[1]||(e[1]=w=>c.value=w),"checked-children":"å¼€å¯","un-checked-children":"å…³é—­","aria-label":"network-acceleration-switch"},null,8,["checked"]),s("div",Ne,[c.value?(k(),S(M,{key:0,type:"info","show-icon":"",message:"ç½‘ç»œåŠ é€Ÿå·²å¼€å¯",description:"æ‚¨æ­£åœ¨å¸®åŠ©å…¶ä»–è®¾å¤‡è½¬å‘æ¶ˆæ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–è®¾å¤‡çš„ä¸­è½¬æœåŠ¡ã€‚"})):(k(),S(M,{key:1,type:"warning","show-icon":"",message:"ç½‘ç»œåŠ é€Ÿå·²å…³é—­",description:"æ‚¨ä¸ä¼šå¸®åŠ©å…¶ä»–è®¾å¤‡è½¬å‘æ¶ˆæ¯ï¼Œå…¶ä»–è®¾å¤‡ä¹Ÿä¸ä¼šå¸®åŠ©æ‚¨è½¬å‘æ¶ˆæ¯ã€‚æ‰€æœ‰é€šä¿¡å‡ä¸ºç›´è¿ã€‚"}))])])]),_:1})]),_:1}),n(A,{xs:24,md:12},{default:l(()=>[n(T,{title:"ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•",bordered:!1},{extra:l(()=>[n(x(ge))]),default:l(()=>[s("div",Ve,[e[14]||(e[14]=s("p",{class:"description"}," å¼€å¯ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•åï¼Œæ‰€æœ‰çš„ PeerJS è¯·æ±‚å’Œå“åº”æ•°æ®éƒ½ä¼šè¢«è®°å½•åˆ°æœ¬åœ° IndexedDB ä¸­ã€‚ è¿™å¯¹äºè°ƒè¯•ç½‘ç»œé—®é¢˜å’Œåˆ†æé€šä¿¡æ•°æ®éå¸¸æœ‰ç”¨ã€‚ ",-1)),n(Y,{checked:g.value,"onUpdate:checked":e[2]||(e[2]=w=>g.value=w),"checked-children":"å¼€å¯","un-checked-children":"å…³é—­","aria-label":"network-logging-switch"},null,8,["checked"]),s("div",je,[g.value?(k(),S(M,{key:0,type:"info","show-icon":"",message:"ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•å·²å¼€å¯"},{description:l(()=>[e[12]||(e[12]=s("div",null,"æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡æ•°æ®éƒ½ä¼šè¢«è®°å½•åˆ°æœ¬åœ°æ•°æ®åº“ä¸­ã€‚",-1)),s("div",Le,[n(C,{type:"link",size:"small",onClick:e[3]||(e[3]=w=>x(a).push("/network-log")),style:{padding:"0"}},{default:l(()=>[...e[11]||(e[11]=[y(" æŸ¥çœ‹ç½‘ç»œæ•°æ®æ—¥å¿— â†’ ",-1)])]),_:1})])]),_:1})):(k(),S(M,{key:1,type:"warning","show-icon":"",message:"ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•å·²å…³é—­"},{description:l(()=>[...e[13]||(e[13]=[y(' ç½‘ç»œé€šä¿¡æ•°æ®ä¸ä¼šè¢«è®°å½•ã€‚å¼€å¯åå¯åœ¨"ç½‘ç»œæ•°æ®æ—¥å¿—"é¡µé¢æŸ¥çœ‹è®°å½•çš„æ•°æ®ã€‚ ',-1)])]),_:1}))])])]),_:1})]),_:1}),n(A,{xs:24,md:12},{default:l(()=>[n(T,{title:"è®¾å¤‡çŠ¶æ€æ£€æµ‹",bordered:!1},{extra:l(()=>[n(x(me))]),default:l(()=>[s("div",De,[e[17]||(e[17]=s("p",{class:"description"}," é…ç½®è®¾å¤‡åœ¨çº¿çŠ¶æ€æ£€æµ‹çš„æ—¶é—´é—´éš”å’Œè¶…æ—¶æ—¶é—´ã€‚ è¾ƒçŸ­çš„é—´éš”å¯ä»¥æ›´å¿«å‘ç°è®¾å¤‡ç¦»çº¿ï¼Œä½†ä¼šå¢åŠ ç½‘ç»œæµé‡ã€‚ ",-1)),n(X,{layout:"vertical"},{default:l(()=>[n(_,{label:"æ£€æµ‹é—´éš”ï¼ˆç§’ï¼‰"},{default:l(()=>[n(Z,{value:b.value,"onUpdate:value":e[4]||(e[4]=w=>b.value=w),min:5,max:600,step:5,style:{width:"100%"},"aria-label":"device-check-interval-input"},null,8,["value"]),e[15]||(e[15]=s("div",{class:"hint-text"}," èŒƒå›´ï¼š5-600 ç§’ï¼Œé»˜è®¤ 20 ç§’ ",-1))]),_:1}),n(_,{label:"è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰"},{default:l(()=>[n(Z,{value:h.value,"onUpdate:value":e[5]||(e[5]=w=>h.value=w),min:3,max:30,step:1,style:{width:"100%"},"aria-label":"device-check-timeout-input"},null,8,["value"]),e[16]||(e[16]=s("div",{class:"hint-text"}," èŒƒå›´ï¼š3-30 ç§’ï¼Œé»˜è®¤ 5 ç§’ã€‚è¶…æ—¶åè®¾å¤‡å°†è¢«æ ‡è®°ä¸ºç¦»çº¿ ",-1))]),_:1})]),_:1}),s("div",Te,[n(M,{type:"info","show-icon":"",message:"è®¾å¤‡çŠ¶æ€æ£€æµ‹é…ç½®"},{description:l(()=>[s("div",null,"å½“å‰é…ç½®ï¼šæ¯ "+N(b.value)+" ç§’æ£€æµ‹ä¸€æ¬¡ï¼Œè¶…æ—¶æ—¶é—´ä¸º "+N(h.value)+" ç§’",1)]),_:1})])])]),_:1})]),_:1}),n(A,{span:24},{default:l(()=>[L.value?(k(),K("div",{key:0,class:be(["inline-message",`inline-message-${J.value}`])},N(L.value),3)):F("",!0),s("div",Be,[n(C,{type:"primary",loading:$.value,disabled:!q.value,onClick:se,"aria-label":"save-settings-button"},{icon:l(()=>[n(x(E))]),default:l(()=>[e[18]||(e[18]=y(" ä¿å­˜è®¾ç½® ",-1))]),_:1},8,["loading","disabled"]),q.value?(k(),S(C,{key:0,onClick:ie},{default:l(()=>[...e[19]||(e[19]=[y(" å–æ¶ˆ ",-1)])]),_:1})):F("",!0),n(C,{onClick:ue},{default:l(()=>[...e[20]||(e[20]=[y(" è¿”å›å‘ç°ä¸­å¿ƒ ",-1)])]),_:1})])]),_:1})]),_:1})])}}}),Je=ye($e,[["__scopeId","data-v-811a928e"]]);export{Je as default};
