import{c as l,I as $,d as se,o as ie,x as ue,k as W,w as r,r as u,e as m,f as _,g as d,a as h,h as b,t as L,j as B,i as I,F as ce,n as de,u as ve,s as fe}from"./index-BYEFqady.js";import{u as ge,a as pe}from"./index-rjUumXYC.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PeerHttpUtil-D02VgYGg.js";import"./networkLogDB-BlD6FS5Z.js";var _e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};function q(n){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?Object(arguments[a]):{},o=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),o.forEach(function(s){be(n,s,e[s])})}return n}function be(n,a,e){return a in n?Object.defineProperty(n,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[a]=e,n}var F=function(a,e){var o=q({},a,e.attrs);return l($,q({},o,{icon:_e}),null)};F.displayName="SaveOutlined";F.inheritAttrs=!1;var we={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z"}}]},name:"thunderbolt",theme:"outlined"};function Q(n){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?Object(arguments[a]):{},o=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),o.forEach(function(s){he(n,s,e[s])})}return n}function he(n,a,e){return a in n?Object.defineProperty(n,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[a]=e,n}var T=function(a,e){var o=Q({},a,e.attrs);return l($,Q({},o,{icon:we}),null)};T.displayName="ThunderboltOutlined";T.inheritAttrs=!1;var ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"};function X(n){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?Object(arguments[a]):{},o=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),o.forEach(function(s){Oe(n,s,e[s])})}return n}function Oe(n,a,e){return a in n?Object.defineProperty(n,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[a]=e,n}var D=function(a,e){var o=X({},a,e.attrs);return l($,X({},o,{icon:ye}),null)};D.displayName="UserOutlined";D.inheritAttrs=!1;const Se={class:"settings-container"},ke={class:"avatar-section"},Ce={class:"avatar-actions"},Pe={class:"network-acceleration-section"},Ue={class:"status-info"},Ie={class:"network-logging-section"},xe={class:"status-info"},ze={style:{"margin-top":"8px"}},Ae={class:"action-buttons"},Me=se({__name:"SettingsView",setup(n){const a=ve(),e=ge(),o=pe(),{setNetworkAccelerationEnabled:s,broadcastNetworkAccelerationStatus:Y,broadcastUserInfoUpdate:Z}=o,v=u(""),k=u(""),f=u(null),C=u(null),N=u(!1),i=u(!1),P=u(!1),g=u(!1),U=u(!1),V=u(!1),x=u(""),H=u("info"),E=u(!1);ie(async()=>{await e.loadUserInfo(),console.log("[SettingsView] userInfo.avatar:",e.userInfo.avatar),v.value=e.userInfo.username||"",k.value=v.value,f.value=e.userInfo.avatar||null,console.log("[SettingsView] avatarPreview set to:",f.value),console.log("[SettingsView] final avatarPreview:",f.value,"type:",typeof f.value),i.value=e.loadNetworkAcceleration(),P.value=i.value,s(i.value),g.value=e.loadNetworkLogging(),U.value=g.value,E.value=!0}),ue(E,c=>{c&&console.log("[SettingsView] userInfoLoaded is true, form initialized")});const R=fe(()=>v.value!==k.value||C.value!==null||N.value||i.value!==P.value||g.value!==U.value);function K(c){G();const t=c.file,p=t?.originFileObj||t;if(p&&p instanceof File){if(!p.type.startsWith("image/")){y("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶","error");return}if(p.size>2*1024*1024){y("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB","error");return}C.value=p;const w=new FileReader;w.onload=z=>{f.value=z.target?.result},w.readAsDataURL(p)}}function ee(){N.value=!0,f.value=null,C.value=null}async function te(){if(G(),!v.value.trim()){y("ç”¨æˆ·åä¸èƒ½ä¸ºç©º","warning");return}V.value=!0;try{const c=v.value.trim(),t=f.value;console.log("[Settings] Saving user info:",{newUsername:c,newAvatar:t,currentUsername:e.userInfo.username});const p=c!==k.value,w=t!==e.userInfo.avatar;console.log("[Settings] Changes detected:",{hasUsernameChange:p,hasAvatarChange:w}),await e.saveUserInfo({username:c,avatar:t}),console.log("[Settings] User info saved. Current userStore.userInfo.username:",e.userInfo.username),(p||w)&&(await Z(),console.log("[Settings] User info update broadcasted to all devices")),i.value!==P.value&&(e.setNetworkAcceleration(i.value),s(i.value),await Y(),y(i.value?"å·²å¼€å¯ç½‘ç»œåŠ é€Ÿ":"å·²å…³é—­ç½‘ç»œåŠ é€Ÿ","success")),g.value!==U.value&&(e.setNetworkLogging(g.value),y(g.value?"å·²å¼€å¯ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•":"å·²å…³é—­ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•","success")),k.value=v.value,P.value=i.value,U.value=g.value,C.value=null,y("è®¾ç½®å·²ä¿å­˜","success"),N.value=!1}catch(c){console.error("[Settings] Save error:",c),y("ä¿å­˜å¤±è´¥","error")}finally{V.value=!1}}function ae(){v.value=k.value,f.value=e.userInfo.avatar,C.value=null,i.value=P.value,g.value=U.value}function ne(){a.push("/center")}function y(c,t="info"){x.value=c,H.value=t}function G(){x.value=""}return(c,t)=>{const p=m("a-input"),w=m("a-form-item"),z=m("a-avatar"),O=m("a-button"),re=m("a-upload"),le=m("a-form"),j=m("a-card"),A=m("a-col"),J=m("a-switch"),M=m("a-alert"),oe=m("a-row");return _(),W("div",Se,[l(oe,{gutter:[16,16]},{default:r(()=>[l(A,{xs:24,md:12},{default:r(()=>[l(j,{title:"ç”¨æˆ·ä¿¡æ¯",bordered:!1},{extra:r(()=>[l(I(D))]),default:r(()=>[l(le,{layout:"vertical"},{default:r(()=>[l(w,{label:"ç”¨æˆ·å"},{default:r(()=>[l(p,{value:v.value,"onUpdate:value":t[0]||(t[0]=S=>v.value=S),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",maxlength:20,"show-count":"","allow-clear":""},null,8,["value"])]),_:1}),l(w,{label:"å¤´åƒ"},{default:r(()=>[d("div",ke,[f.value?(_(),h(z,{key:0,size:80,src:f.value},{default:r(()=>[b(L(v.value.charAt(0).toUpperCase()),1)]),_:1},8,["src"])):(_(),h(z,{key:1,size:80},{default:r(()=>[b(L(v.value.charAt(0).toUpperCase()),1)]),_:1})),d("div",Ce,[l(re,{"before-upload":()=>!1,onChange:K,"show-upload-list":!1,accept:"image/*"},{default:r(()=>[l(O,{size:"small"},{icon:r(()=>[...t[4]||(t[4]=[b("ğŸ“·",-1)])]),default:r(()=>[t[5]||(t[5]=b(" é€‰æ‹©å›¾ç‰‡ ",-1))]),_:1})]),_:1}),f.value?(_(),h(O,{key:0,size:"small",danger:"",onClick:ee,"aria-label":"remove-avatar-button"},{default:r(()=>[...t[6]||(t[6]=[b(" ç§»é™¤ ",-1)])]),_:1})):B("",!0)])]),t[7]||(t[7]=d("div",{class:"avatar-hint"}," æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 2MB ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),l(A,{xs:24,md:12},{default:r(()=>[l(j,{title:"ç½‘ç»œåŠ é€Ÿ",bordered:!1},{extra:r(()=>[l(I(T))]),default:r(()=>[d("div",Pe,[t[8]||(t[8]=d("p",{class:"description"}," å¼€å¯ç½‘ç»œåŠ é€Ÿåï¼Œæ‚¨çš„è®¾å¤‡å¯ä»¥å¸®åŠ©å…¶ä»–è®¾å¤‡è½¬å‘æ¶ˆæ¯ã€‚ åŒæ—¶ï¼Œå½“æ‚¨ä¸æŸäº›è®¾å¤‡ç›´è¿å¤±è´¥æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–å¼€å¯ç½‘ç»œåŠ é€Ÿçš„è®¾å¤‡ä¸­è½¬æ¶ˆæ¯ã€‚ ",-1)),l(J,{checked:i.value,"onUpdate:checked":t[1]||(t[1]=S=>i.value=S),"checked-children":"å¼€å¯","un-checked-children":"å…³é—­","aria-label":"network-acceleration-switch"},null,8,["checked"]),d("div",Ue,[i.value?(_(),h(M,{key:0,type:"info","show-icon":"",message:"ç½‘ç»œåŠ é€Ÿå·²å¼€å¯",description:"æ‚¨æ­£åœ¨å¸®åŠ©å…¶ä»–è®¾å¤‡è½¬å‘æ¶ˆæ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–è®¾å¤‡çš„ä¸­è½¬æœåŠ¡ã€‚"})):(_(),h(M,{key:1,type:"warning","show-icon":"",message:"ç½‘ç»œåŠ é€Ÿå·²å…³é—­",description:"æ‚¨ä¸ä¼šå¸®åŠ©å…¶ä»–è®¾å¤‡è½¬å‘æ¶ˆæ¯ï¼Œå…¶ä»–è®¾å¤‡ä¹Ÿä¸ä¼šå¸®åŠ©æ‚¨è½¬å‘æ¶ˆæ¯ã€‚æ‰€æœ‰é€šä¿¡å‡ä¸ºç›´è¿ã€‚"}))])])]),_:1})]),_:1}),l(A,{xs:24,md:12},{default:r(()=>[l(j,{title:"ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•",bordered:!1},{extra:r(()=>[l(I(ce))]),default:r(()=>[d("div",Ie,[t[12]||(t[12]=d("p",{class:"description"}," å¼€å¯ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•åï¼Œæ‰€æœ‰çš„ PeerJS è¯·æ±‚å’Œå“åº”æ•°æ®éƒ½ä¼šè¢«è®°å½•åˆ°æœ¬åœ° IndexedDB ä¸­ã€‚ è¿™å¯¹äºè°ƒè¯•ç½‘ç»œé—®é¢˜å’Œåˆ†æé€šä¿¡æ•°æ®éå¸¸æœ‰ç”¨ã€‚ ",-1)),l(J,{checked:g.value,"onUpdate:checked":t[2]||(t[2]=S=>g.value=S),"checked-children":"å¼€å¯","un-checked-children":"å…³é—­","aria-label":"network-logging-switch"},null,8,["checked"]),d("div",xe,[g.value?(_(),h(M,{key:0,type:"info","show-icon":"",message:"ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•å·²å¼€å¯"},{description:r(()=>[t[10]||(t[10]=d("div",null,"æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡æ•°æ®éƒ½ä¼šè¢«è®°å½•åˆ°æœ¬åœ°æ•°æ®åº“ä¸­ã€‚",-1)),d("div",ze,[l(O,{type:"link",size:"small",onClick:t[3]||(t[3]=S=>I(a).push("/network-log")),style:{padding:"0"}},{default:r(()=>[...t[9]||(t[9]=[b(" æŸ¥çœ‹ç½‘ç»œæ•°æ®æ—¥å¿— â†’ ",-1)])]),_:1})])]),_:1})):(_(),h(M,{key:1,type:"warning","show-icon":"",message:"ç½‘ç»œæ•°æ®æ—¥å¿—è®°å½•å·²å…³é—­"},{description:r(()=>[...t[11]||(t[11]=[b(' ç½‘ç»œé€šä¿¡æ•°æ®ä¸ä¼šè¢«è®°å½•ã€‚å¼€å¯åå¯åœ¨"ç½‘ç»œæ•°æ®æ—¥å¿—"é¡µé¢æŸ¥çœ‹è®°å½•çš„æ•°æ®ã€‚ ',-1)])]),_:1}))])])]),_:1})]),_:1}),l(A,{span:24},{default:r(()=>[x.value?(_(),W("div",{key:0,class:de(["inline-message",`inline-message-${H.value}`])},L(x.value),3)):B("",!0),d("div",Ae,[l(O,{type:"primary",loading:V.value,disabled:!R.value,onClick:te,"aria-label":"save-settings-button"},{icon:r(()=>[l(I(F))]),default:r(()=>[t[13]||(t[13]=b(" ä¿å­˜è®¾ç½® ",-1))]),_:1},8,["loading","disabled"]),R.value?(_(),h(O,{key:0,onClick:ae},{default:r(()=>[...t[14]||(t[14]=[b(" å–æ¶ˆ ",-1)])]),_:1})):B("",!0),l(O,{onClick:ne},{default:r(()=>[...t[15]||(t[15]=[b(" è¿”å›å‘ç°ä¸­å¿ƒ ",-1)])]),_:1})])]),_:1})]),_:1})])}}}),$e=me(Me,[["__scopeId","data-v-92c45805"]]);export{$e as default};
